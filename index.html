<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qiuzhaopeng.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Stay hungry, stay foolish">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhaopeng&#39;s Homepage">
<meta property="og:url" content="http://qiuzhaopeng.github.io/index.html">
<meta property="og:site_name" content="Zhaopeng&#39;s Homepage">
<meta property="og:description" content="Stay hungry, stay foolish">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zhaopeng QIU">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://qiuzhaopeng.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Zhaopeng's Homepage</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Zhaopeng's Homepage</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">My tech notebook</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    

  <a href="https://github.com/QiuZhaopeng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/02/03/MQTT-communication-via-Cloud-Broker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/03/MQTT-communication-via-Cloud-Broker/" class="post-title-link" itemprop="url">MQTT communication via Cloud Broker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-03 11:30:58 / Modified: 11:32:32" itemprop="dateCreated datePublished" datetime="2021-02-03T11:30:58+01:00">2021-02-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IoT/" itemprop="url" rel="index"><span itemprop="name">IoT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In my startup, we have worked on some AIoT (AI + IoT) projects and we got some MVP for demo to our client. In some certain project, we have used MQTT protocol for collecting sensors data and transporting them to other smart devices. So in this post, I would like to present a simple demo for building a MQTT communication via a broker on AWS cloud.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/0j7t523z4u1794795e8n.png" alt="Alt Text"></p>
<blockquote>
<p>MQTT (Message Queuing Telemetry Transport) is an open OASIS and ISO standard (ISO/IEC 20922) lightweight, publish-subscribe network protocol that transports messages between devices. The protocol usually runs over TCP/IP; however, any network protocol that provides ordered, lossless, bi-directional connections can support MQTT. It is designed for connections with remote locations where a “small code footprint” is required or the network bandwidth is limited.</p>
</blockquote>
<h2 id="Cloud-side"><a href="#Cloud-side" class="headerlink" title="Cloud side"></a>Cloud side</h2><p>On AWS server, I use docker to run an <strong>emqx</strong> service which play a role as “broker”. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --rm -ti --name emqx -p 18083:18083 -p 1883:1883 -e EMQX_ADMIN_PASSWORD=<span class="string">&quot;myPasswd&quot;</span> emqx/emqx:latest</span><br></pre></td></tr></table></figure>
<p>Output of my putty terminal:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/bvggl47m4yijn4ip8jow.png" alt="Alt Text"></p>
<p>When this service is running, one can access to its administration page by visiting page <code>http://3.138.200.179:18083/#/</code>:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/oocjtky7e5sgkjcinidc.png" alt="Alt Text"></p>
<h2 id="Subscriber"><a href="#Subscriber" class="headerlink" title="Subscriber"></a>Subscriber</h2><p>I have a subcriber.py file which defines a <code>mqtt</code> client who connects to cloud broker with port 1883 and subscribes message named <code>&#39;qiu_data&#39;</code>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paho.mqtt.client <span class="keyword">as</span> mqtt</span><br><span class="line"></span><br><span class="line"><span class="comment">## callback upon connection</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_connect</span>(<span class="params">client, userdata, flags, rc</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Connected, result code: &quot;</span> + <span class="built_in">str</span>(rc))</span><br><span class="line"></span><br><span class="line"><span class="comment">## callback upon arrival of msg</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">client, userdata, msg</span>):</span></span><br><span class="line">    print(msg.topic + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(msg.payload))</span><br><span class="line"></span><br><span class="line">client = mqtt.Client()</span><br><span class="line">client.on_connect = on_connect</span><br><span class="line">client.on_message = on_message</span><br><span class="line"><span class="comment"># client.on_disconnect = on_disconnect</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## I have not yet bindded a domain name for my AWS ECS</span></span><br><span class="line">client.connect(<span class="string">&#x27;3.138.200.179&#x27;</span>, <span class="number">1883</span>, <span class="number">600</span>) <span class="comment"># 600ms: keepalive interval setting</span></span><br><span class="line">client.subscribe(<span class="string">&#x27;qiu_data&#x27;</span>, qos=<span class="number">0</span>)</span><br><span class="line">client.loop_forever() <span class="comment"># keep running</span></span><br></pre></td></tr></table></figure>
<h2 id="Publisher"><a href="#Publisher" class="headerlink" title="Publisher"></a>Publisher</h2><p>I have a publisher.py file which defines another <code>mqtt</code> client who connects to cloud broker with port 1883 and publish some data in  <code>&#39;qiu_data&#39;</code> messages. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paho.mqtt.client <span class="keyword">as</span> mqtt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_connect</span>(<span class="params">client, userdata, flags, rc</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Connected with result code: &quot;</span> + <span class="built_in">str</span>(rc))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">client, userdata, msg</span>):</span></span><br><span class="line">    print(msg.topic + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(msg.payload))</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;IoT&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: time.time(),</span><br><span class="line">    <span class="string">&quot;msgId&quot;</span>:<span class="string">&quot;8ed7a307-0e82-9738-xxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;temp&quot;</span>:<span class="number">23.5</span>,</span><br><span class="line">        <span class="string">&quot;speed&quot;</span>:<span class="number">46.8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">param = json.dumps(data)</span><br><span class="line"></span><br><span class="line">client = mqtt.Client()</span><br><span class="line">client.on_connect = on_connect</span><br><span class="line">client.on_message = on_message</span><br><span class="line">client.connect(<span class="string">&#x27;3.138.200.179&#x27;</span>, <span class="number">1883</span>, <span class="number">600</span>) <span class="comment"># 600ms for keepalive</span></span><br><span class="line">client.publish(<span class="string">&#x27;qiu_data&#x27;</span>, payload=<span class="string">&#x27;hello world&#x27;</span>, qos=<span class="number">0</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">client.publish(<span class="string">&quot;qiu_data&quot;</span>, payload=param, qos=<span class="number">0</span>) </span><br></pre></td></tr></table></figure>
<h2 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h2><p>In a terminal I type <code>python publisher.py</code>, and in a second terminal I type <code>python publisher.py</code>. See the published topics have been received in the subscriber’s terminal:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/1hhk9ll9kb4n3eokhva9.PNG" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/18/Breathing-Detection-Using-Computer-vision-with-webcam/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/18/Breathing-Detection-Using-Computer-vision-with-webcam/" class="post-title-link" itemprop="url">Breathing Detection Using Computer vision with webcam</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-18 14:07:48 / Modified: 15:29:59" itemprop="dateCreated datePublished" datetime="2021-01-18T14:07:48+01:00">2021-01-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>When I worked on the development of a healthcare device for detecting baby Apnea (pause of breathing), I have spent some time on studying possible technological solutions. I have tried several different types of sensors including: RGB-camera, 3-axis accelerometer, heat camera, depth camera (kinect), etc. The rgb-camera-based solution is very interesting. Firstly because they are low-cost; moreover, it does not require mounting the sensor on baby’s body thus the comfort is guaranteed. That’s why I worked for about 3 weeks on this solution.</p>
<p>As experiments, I tried multiple possible algorithms including: feature points tracking, inter-frame difference checking, flux, and  color nuance variation tracking. </p>
<p>In this post, I want to present the latter one. This work is inspired by <a target="_blank" rel="noopener" href="http://people.csail.mit.edu/mrub/vidmag/">this study</a>. The basic idea is to track the color variation of an ROI on human face. The blood circulation and breathing will cause slight color variation of our skin. This change is so slight that our eyes can not perceive it at all. However, a normal webcam can identify color variation with a resolution as high as 2^16 grades. </p>
<h2 id="ROI-on-human-forehead"><a href="#ROI-on-human-forehead" class="headerlink" title="ROI on human forehead"></a>ROI on human forehead</h2><p>I have chosen a small rectangle area as ROI (region of interest) for tracking color variation. Below is the part of code for this purpose.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">x1 = <span class="number">0.4</span></span><br><span class="line">x2 = <span class="number">0.6</span></span><br><span class="line">y1 = <span class="number">0.1</span></span><br><span class="line">y2 = <span class="number">0.25</span></span><br><span class="line">face_cascade=cv2.CascadeClassifier(cv2.data.haarcascades + <span class="string">&quot;haarcascade_frontalface_default.xml&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFaceROI</span>(<span class="params">img</span>):</span></span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)</span><br><span class="line">    faces = face_cascade.detectMultiScale(gray, <span class="number">1.2</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(faces)&gt;<span class="number">0</span>:</span><br><span class="line">        img=cv2.rectangle(img, (faces[<span class="number">0</span>][<span class="number">0</span>] + <span class="built_in">int</span>(x1*faces[<span class="number">0</span>][<span class="number">2</span>]), faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y1*faces[<span class="number">0</span>][<span class="number">3</span>]) ), (faces[<span class="number">0</span>][<span class="number">0</span>]+ <span class="built_in">int</span>(x2*faces[<span class="number">0</span>][<span class="number">2</span>]), faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y2*faces[<span class="number">0</span>][<span class="number">3</span>]) ), (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [faces[<span class="number">0</span>][<span class="number">0</span>]+<span class="built_in">int</span>(x1*faces[<span class="number">0</span>][<span class="number">2</span>]),  faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y1*faces[<span class="number">0</span>][<span class="number">3</span>]),  faces[<span class="number">0</span>][<span class="number">0</span>]+ <span class="built_in">int</span>(x2*faces[<span class="number">0</span>][<span class="number">2</span>]), faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y2*faces[<span class="number">0</span>][<span class="number">3</span>])]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<h2 id="Color-Calculation"><a href="#Color-Calculation" class="headerlink" title="Color Calculation"></a>Color Calculation</h2><p>We simply calculate the average value of a given color channel (I used the green channel in my test) of all the pixels in the selected ROI.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getColorAverage</span>(<span class="params">frame, color_id</span>):</span></span><br><span class="line">    <span class="keyword">return</span> frame[:,:,color_id].<span class="built_in">sum</span>()*<span class="number">1.0</span> / (frame.shape[<span class="number">0</span>]*frame.shape[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h2 id="Drawbacks"><a href="#Drawbacks" class="headerlink" title="Drawbacks"></a>Drawbacks</h2><p>Entire code has been uploaded to github repo below:<br><a target="_blank" rel="noopener" href="https://github.com/QiuZhaopeng/CV2_heartbeat_breathing_detection">https://github.com/QiuZhaopeng/CV2_heartbeat_breathing_detection</a></p>
<p>This solution suffers from limitations in multiple aspects, e.g. the lighting condition, human should stay still, the camera noisy level, etc. That’s why I did not choose this solution for our product (finally we chose the 6-axis sensor solution). </p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>Below is the snapshot of the execution of this program. As one can see, there are low-frequency wave shape mixed with high-frequency sawtooth (small peaks).<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/jfa4iwr1jimxi67bjiro.png" alt="Alt Text"><br>I measured my pulses during execution of this program. It can be verified that each small peak corresponds to a pulse beat (heart beat). And the large peak-valley transition corresponds to breathing cycles. </p>
<p>Anyone interested in this small experiment are encouraged to try it and do some further work. Good luck.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/14/MongoDB-Compass-connection-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/14/MongoDB-Compass-connection-issue/" class="post-title-link" itemprop="url">MongoDB Compass connection issue</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-14 12:27:03 / Modified: 12:33:28" itemprop="dateCreated datePublished" datetime="2021-01-14T12:27:03+01:00">2021-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IT/" itemprop="url" rel="index"><span itemprop="name">IT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>I am working on migration of our <em>Data Warehouse</em> project from <em>Alibaba Cloud</em> to <em>Huawei Cloud</em> this week. All goes well, except one issue occurs when I tried to connect to <strong>MongoDB</strong> using <strong>MongoDB Compass Community</strong>. </p>
<p>As I have presented in my <a target="_blank" rel="noopener" href="https://dev.to/jemaloqiu/install-mongodb-with-docker-in-ubuntu-18-04-4pbi">previous post</a>, I have deployed <strong>MongoDB</strong> service using <strong>docker</strong> and I have successfully connected to my <strong>MongoDB</strong> database from <strong>IPython</strong> console. So I firstly tried again the visit from <strong>IPython</strong> today to make sure that the <strong>MongoDB</strong> service is still running on Huawei ECS. It IS still working well:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/inkrwaealqvcv183n10a.png" alt="Alt Text"></p>
<p>Then I open <strong>MongoDB Compass Community</strong> and fill the login information as below (our domain name has not yet been authorized so I have to use Ip address for <em>hostname</em>):<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/e2uyrzwtepgxxkaao9q8.png" alt="Alt Text"><br>However, when I click “CONNECT” button, nothing happens.</p>
<p>After a close investigation, I found the reason. After I filled all the fields for connection, <strong>Compass</strong> yielded a connection URI string as below.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/iwfcg0mb6hebayyq9lhe.png" alt="Alt Text"></p>
<p>In fact, as explained in official manual of <strong>MongoDB</strong>, the standard URI syntax for connection is as:<br><code>mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</code>.<br>Thus in my case, <strong>MongoDB Compass</strong> has strangely used <code>ip:port</code> as the Database name to visit. Since there is no database with such name, so it shall do nothing and stays in the connection interface.</p>
<p>Now I correct the URI string manually and fill my database name <em>suppliers</em> into this string as below:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/1wez341jzvar701lbflr.png" alt="Alt Text"></p>
<p>Once I click “CONNECT”, <strong>Compass</strong> jumps as expected to display interface of the queried database now:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/6s8udjmskichqb0ay5id.png" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/12/Native-Mobile-Application-dev-using-HTML5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/Native-Mobile-Application-dev-using-HTML5/" class="post-title-link" itemprop="url">Native Mobile Application dev using HTML5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-12 18:54:35" itemprop="dateCreated datePublished" datetime="2021-01-12T18:54:35+01:00">2021-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-13 10:14:58" itemprop="dateModified" datetime="2021-01-13T10:14:58+01:00">2021-01-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IT/" itemprop="url" rel="index"><span itemprop="name">IT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>I started learning <strong>JavaScript</strong> since November 2018. Since then, I fell in love with this powerful language. In this post, I would like to share my experience of app dev using <strong>JavaScript</strong>  and to encourage you guys to develop apps using <strong>HTML5</strong> tech.</p>
<p>My first experience with <strong>JS</strong> started with <a target="_blank" rel="noopener" href="https://www.dcloud.io/mui.html"><code>MUI</code></a> by using which I aimed to develop an mobile application to measure human abdomen movements using smartphone’s accelerator sensor. <code>MUI</code> is a H5-based framework for developing “native” applications (can be called Chinese-version <code>Reaction Native</code>?). The <code>MUI</code> team has also developed <code>HTML5plus</code> sdk (Chinese-version <code>Cordova</code>) which grants applications the access to host device’s capabilities such as sensors, phone status, etc. With these tools, I have easily developed my application within two days. One month later, we have decided to develop an application for communicating with our smart wearable hardware via Bluetooth. Thus along with progress of hardware development, I have developed another application for testing communications with the hardware and for collecting test data. Several months later, this application becomes a very useful tool for our team, which is used to: flash the firmware, testing the stability of BLE connection, adjusting parameters for algorithm and embedded software, collecting debug logs, data collecting during nightly tests, ROB (robustness) issues investigation, etc.</p>
<p>For copyright reason, I cannot share the source code of this application. Below are screenshots of two non-secret parts of my code. The bluetooth dev manual is given <a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/bluetooth.html">here</a>.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/rlz6vtuje0xeivoeiykx.PNG" alt="Alt Text"><br><img src="https://dev-to-uploads.s3.amazonaws.com/i/b3kgwudn816tvqoqo0co.PNG" alt="Alt Text"></p>
<p>This is a video showing how I did the test with my application and the wearable hardware prototype.</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/o4wFFWRzx88" frameborder="0" loading="lazy" allowfullscreen></iframe></div> 



<p>Another video of motion data collection on a premature baby using my app:</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/NwDZiueJlrw" frameborder="0" loading="lazy" allowfullscreen></iframe></div> 
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/12/Reinforcement-Learning-with-TF2-and-Gym-Actor-Critic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/Reinforcement-Learning-with-TF2-and-Gym-Actor-Critic/" class="post-title-link" itemprop="url">Reinforcement Learning with TF2 and Gym: Actor-Critic</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-12 10:29:44 / Modified: 10:35:39" itemprop="dateCreated datePublished" datetime="2021-01-12T10:29:44+01:00">2021-01-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Recently I started to do exercise with a new RL method: <strong>Actor-Critic</strong>. The basic idea is quite similar to <strong>GAN network</strong>. Unlike <strong>Policy Gradient</strong> in which a single neural network is trained, <strong>Actor-Critic</strong> uses two neural networks: an “actor” for performing actions and a “critic” for evaluating action of the actor. I refer to <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=xjd7Jq9wPQY">this page</a> for details of this method. </p>
<h3 id="Model-presentation"><a href="#Model-presentation" class="headerlink" title="Model presentation"></a>Model presentation</h3><p>Given a state <code>s_t</code> at time <em>t</em>, the network calculates the action probabilities and chooses an action <code>a_t</code> to apply on env:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/qyn1s4ckmrhdb5p2tsoq.PNG" alt="Alt Text"></p>
<p>After the application of action <code>a_t</code>, then env updated accordingly, yields reward <code>r_t</code>, we observe at next time step t+1 a new state <code>s_t+1</code> which results in a new sampled action <code>a_t+1</code>:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/xgrowra6h096oaoeho52.PNG" alt="Alt Text"></p>
<h3 id="Steps-of-the-basic-Actor-Critic-method"><a href="#Steps-of-the-basic-Actor-Critic-method" class="headerlink" title="Steps of the basic Actor-Critic method"></a>Steps of the basic Actor-Critic method</h3><p>Unlike the <strong>Policy Gradient</strong> which needs to gather all data of an episode to calculate gradients, Actor-Critic method performs model update in every agent-env interaction loop :</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/7a2lsxp4osi3vur2kop3.PNG" alt="Alt Text"></p>
<h3 id="Implementation-with-CartPole-game"><a href="#Implementation-with-CartPole-game" class="headerlink" title="Implementation with CartPole game"></a>Implementation with CartPole game</h3><p>I followed <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2vJtbAha3To">this youtube video</a> for my first Actor-Critic exercise. It was initially based on pure <strong>Keras</strong> thus I have modified some of his code for using <strong>tensorflow</strong>. I also disabled eager mode because of a runtime error (I am using Tensorflow v2 on my laptop).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Activation, Dense, Input</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> Adam</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, alpha, beta, gamma=<span class="number">0.99</span>, n_actions=<span class="number">2</span>, \</span></span></span><br><span class="line"><span class="function"><span class="params">                layer1_size=<span class="number">1024</span>, layer2_size=<span class="number">512</span>, input_dims=<span class="number">4</span></span>):</span></span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.alpha = alpha</span><br><span class="line">        self.beta = beta</span><br><span class="line">        self.input_dims = input_dims</span><br><span class="line">        self.fc1_dims = layer1_size</span><br><span class="line">        self.fc2_dims = layer2_size</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        </span><br><span class="line">        self.actor, self.critic, self.policy = self.build_network()</span><br><span class="line">        </span><br><span class="line">        self.action_space = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n_actions)]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_network</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">input</span> = Input(shape=(self.input_dims, ))</span><br><span class="line">        delta = Input(shape=[<span class="number">1</span>])</span><br><span class="line">        dense1 = Dense(self.fc1_dims, activation=<span class="string">&quot;relu&quot;</span>)(<span class="built_in">input</span>)</span><br><span class="line">        dense2 = Dense(self.fc2_dims, activation=<span class="string">&quot;relu&quot;</span>)(dense1)</span><br><span class="line">        probs = Dense(self.n_actions, activation=<span class="string">&quot;softmax&quot;</span>)(dense2)</span><br><span class="line">        values = Dense(<span class="number">1</span>, activation=<span class="string">&quot;linear&quot;</span>)(dense2)</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">custom_loss</span>(<span class="params">y_true, y_pred</span>):</span></span><br><span class="line">            out = K.clip(y_pred, <span class="number">1e-8</span>, <span class="number">1</span>-<span class="number">1e-8</span>)  </span><br><span class="line">            log_lik = y_true * K.log(out)            </span><br><span class="line">            <span class="keyword">return</span> K.<span class="built_in">sum</span>(-log_lik*delta)</span><br><span class="line">            </span><br><span class="line">        actor = Model(inputs=[<span class="built_in">input</span>, delta], outputs=[probs])</span><br><span class="line">        actor.<span class="built_in">compile</span>(optimizer=Adam(lr=self.alpha), loss=custom_loss)</span><br><span class="line">        </span><br><span class="line">        critic = Model(inputs=[<span class="built_in">input</span>], outputs=[values])</span><br><span class="line">        critic.<span class="built_in">compile</span>(optimizer=Adam(lr=self.beta), loss=<span class="string">&quot;mse&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        policy = Model(inputs=[<span class="built_in">input</span>], outputs=[probs])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> actor, critic, policy</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">choose_action</span>(<span class="params">self, observation</span>):</span></span><br><span class="line">    </span><br><span class="line">        state = observation[np.newaxis, :]</span><br><span class="line">        probs = self.policy.predict(state)[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        action = np.random.choice(self.action_space, p=probs)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">learn</span>(<span class="params">self, state, action, reward, state_, done</span>):</span></span><br><span class="line">        state = state[np.newaxis, :]</span><br><span class="line">        state_ = state_[np.newaxis, :]</span><br><span class="line">        critic_value_ = self.critic.predict(state_)</span><br><span class="line">        critic_value = self.critic.predict(state)</span><br><span class="line">        </span><br><span class="line">        target = reward + self.gamma*critic_value_*(<span class="number">1</span>-<span class="built_in">int</span>(done))</span><br><span class="line">        delta = target - critic_value</span><br><span class="line">        </span><br><span class="line">        actions = np.zeros([<span class="number">1</span>, self.n_actions])</span><br><span class="line">        actions[np.arange(<span class="number">1</span>), action] = <span class="number">1.0</span></span><br><span class="line">        </span><br><span class="line">        self.actor.fit([state, delta], actions, verbose=<span class="number">0</span>)</span><br><span class="line">        self.critic.fit(state, target, verbose=<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    agent=Agent(alpha=<span class="number">0.0001</span>, beta=<span class="number">0.0005</span>)</span><br><span class="line">    env = gym.make(<span class="string">&quot;CartPole-v0&quot;</span>)</span><br><span class="line">    score_history = []</span><br><span class="line">    num_episodes = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">        done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        observation = env.reset()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">            env.render()</span><br><span class="line">            action = agent.choose_action(observation)</span><br><span class="line">            observation_, reward, done, info= env.step(action)</span><br><span class="line">            agent.learn(observation, action, reward, observation_, done)</span><br><span class="line">            observation = observation_</span><br><span class="line">            score+=reward</span><br><span class="line">            </span><br><span class="line">        score_history.append(score)</span><br><span class="line">        avg_score = np.mean(score_history[-<span class="number">100</span>:])</span><br><span class="line">        print(<span class="string">&quot;episode &quot;</span>, i, <span class="string">&quot;score %.2f average score %.2f&quot;</span> % (score, avg_score))</span><br></pre></td></tr></table></figure>

<h3 id="A-newer-version"><a href="#A-newer-version" class="headerlink" title="A newer version"></a>A newer version</h3><p>I have updated the program shown above to allow eager mode. The main difference is the introduction of the custom loss function for actor. It works well, however, the running speed is much slower after my modification (I am looking forward to Refactoring it later).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">&#x27;TF_CPP_MIN_LOG_LEVEL&#x27;</span>] = <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> tf.__version__.startswith(<span class="string">&quot;1.&quot;</span>):    </span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Error!! You are using tensorflow-v1&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Activation, Dense, Input</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> Adam</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, alpha, beta, gamma=<span class="number">0.99</span>, n_actions=<span class="number">2</span>, \</span></span></span><br><span class="line"><span class="function"><span class="params">                layer1_size=<span class="number">1024</span>, layer2_size=<span class="number">512</span>, input_dims=<span class="number">4</span></span>):</span></span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.alpha = alpha</span><br><span class="line">        self.beta = beta</span><br><span class="line">        self.input_dims = input_dims</span><br><span class="line">        self.fc1_dims = layer1_size</span><br><span class="line">        self.fc2_dims = layer2_size</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        </span><br><span class="line">        self.actor, self.critic, self.policy = self.build_network()</span><br><span class="line">        </span><br><span class="line">        self.action_space = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n_actions)]</span><br><span class="line"></span><br><span class="line">        self.optimizer = tf.keras.optimizers.Adam(learning_rate=self.alpha)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_network</span>(<span class="params">self</span>):</span></span><br><span class="line">    </span><br><span class="line">        <span class="built_in">input</span> = Input(shape=(self.input_dims, ))</span><br><span class="line">        delta = Input(shape=[<span class="number">1</span>])</span><br><span class="line">        dense1 = Dense(self.fc1_dims, activation=<span class="string">&quot;relu&quot;</span>)(<span class="built_in">input</span>)</span><br><span class="line">        dense2 = Dense(self.fc2_dims, activation=<span class="string">&quot;relu&quot;</span>)(dense1)</span><br><span class="line">        probs = Dense(self.n_actions, activation=<span class="string">&quot;softmax&quot;</span>)(dense2)</span><br><span class="line">        values = Dense(<span class="number">1</span>, activation=<span class="string">&quot;linear&quot;</span>)(dense2)</span><br><span class="line"></span><br><span class="line">        actor = Model(inputs=[<span class="built_in">input</span>, delta], outputs=[probs])</span><br><span class="line">        </span><br><span class="line">        critic = Model(inputs=[<span class="built_in">input</span>], outputs=[values])</span><br><span class="line">        critic.<span class="built_in">compile</span>(optimizer=Adam(lr=self.beta), loss=<span class="string">&quot;mse&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        policy = Model(inputs=[<span class="built_in">input</span>], outputs=[probs])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> actor, critic, policy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">choose_action</span>(<span class="params">self, observation</span>):</span></span><br><span class="line">    </span><br><span class="line">        state = observation[np.newaxis, :]</span><br><span class="line">        probs = self.policy.predict(state)[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        action = np.random.choice(self.action_space, p=probs)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">learn</span>(<span class="params">self, state, action, reward, state_, done</span>):</span></span><br><span class="line">        state = state[np.newaxis, :]</span><br><span class="line">        state_ = state_[np.newaxis, :]</span><br><span class="line">        critic_value_ = self.critic.predict(state_)</span><br><span class="line">        critic_value = self.critic.predict(state)</span><br><span class="line">        </span><br><span class="line">        target = reward + self.gamma*critic_value_*(<span class="number">1</span>-<span class="built_in">int</span>(done))</span><br><span class="line">        delta = target - critic_value</span><br><span class="line">        </span><br><span class="line">        actions = np.zeros([<span class="number">1</span>, self.n_actions])</span><br><span class="line">        actions[np.arange(<span class="number">1</span>), action] = <span class="number">1.0</span></span><br><span class="line">        </span><br><span class="line">        self.critic.fit(state, target, verbose=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">            y_pred = self.actor(state)</span><br><span class="line">            out = K.clip(y_pred, <span class="number">1e-8</span>, <span class="number">1</span>-<span class="number">1e-8</span>)  </span><br><span class="line">            log_lik = actions * K.log(out)            </span><br><span class="line">            myloss = K.<span class="built_in">sum</span>(-log_lik*delta)</span><br><span class="line">        grads = tape.gradient(myloss, self.actor.trainable_variables)</span><br><span class="line"></span><br><span class="line">        self.optimizer.apply_gradients(<span class="built_in">zip</span>(grads, self.actor.trainable_variables))</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    agent=Agent(alpha=<span class="number">0.0001</span>, beta=<span class="number">0.0005</span>)</span><br><span class="line"></span><br><span class="line">    ENV_SEED = <span class="number">1024</span>  <span class="comment">## Reproducibility of the game</span></span><br><span class="line">    NP_SEED = <span class="number">1024</span>  <span class="comment">## Reproducibility of numpy random</span></span><br><span class="line">    env = gym.make(<span class="string">&#x27;CartPole-v0&#x27;</span>)</span><br><span class="line">    env = env.unwrapped    <span class="comment"># use unwrapped version, otherwise episodes will terminate after 200 steps</span></span><br><span class="line">    env.seed(ENV_SEED)  </span><br><span class="line">    np.random.seed(NP_SEED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">### The Discrete space allows a fixed range of non-negative numbers, so in this case valid actions are either 0 or 1. </span></span><br><span class="line">    print(env.action_space)</span><br><span class="line">    <span class="comment">### The Box space represents an n-dimensional box, so valid observations will be an array of 4 numbers. </span></span><br><span class="line">    print(env.observation_space)</span><br><span class="line">    <span class="comment">### We can also check the Box’s bounds:</span></span><br><span class="line">    print(env.observation_space.high)</span><br><span class="line">    print(env.observation_space.low)</span><br><span class="line"></span><br><span class="line">    score_history = []</span><br><span class="line">    num_episodes = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">        done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        observation = env.reset()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">            env.render()</span><br><span class="line">            action = agent.choose_action(observation)</span><br><span class="line">            observation_, reward, done, info= env.step(action)</span><br><span class="line">            agent.learn(observation, action, reward, observation_, done)</span><br><span class="line">            observation = observation_</span><br><span class="line">            score+=reward</span><br><span class="line">            </span><br><span class="line">        score_history.append(score)</span><br><span class="line">        avg_score = np.mean(score_history[-<span class="number">100</span>:])</span><br><span class="line">        print(<span class="string">&quot;episode &quot;</span>, i, <span class="string">&quot;score %.2f average score %.2f&quot;</span> % (score, avg_score))</span><br></pre></td></tr></table></figure>
<p>The training converges ideally. Below is a snapshot of the execution output:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/h7kwg09gwsep9a6np10v.PNG" alt="Alt Text"></p>
<h5 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h5><p>*<a target="_blank" rel="noopener" href="https://github.com/wangshusen/DRL">https://github.com/wangshusen/DRL</a><br>*<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2vJtbAha3To">https://www.youtube.com/watch?v=2vJtbAha3To</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/11/A-A-Star-algorithm-for-solving-Sliding-Tiles-Game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/11/A-A-Star-algorithm-for-solving-Sliding-Tiles-Game/" class="post-title-link" itemprop="url">A* (A-Star) algorithm for solving Sliding Tiles Game</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-11 12:58:45 / Modified: 13:00:20" itemprop="dateCreated datePublished" datetime="2021-01-11T12:58:45+01:00">2021-01-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This weekend I found in my old hard disk a tiny game I wrote years ago. I was learning motion planning algorithms in that period, thus this game was one exercise of mine for testing the <strong>A* search algorithm</strong> (see <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/A*_search_algorithm">introduction</a>). This algorithm is a very traditional one thus I will not present it in my post. One who is interested can read [this book] (<a target="_blank" rel="noopener" href="http://lavalle.pl/planning/">http://lavalle.pl/planning/</a>) By Steven M. LaValle for details. </p>
<h2 id="Number-tiles-Game-in-Visual-Studio"><a href="#Number-tiles-Game-in-Visual-Studio" class="headerlink" title="Number tiles Game in Visual Studio"></a>Number tiles Game in Visual Studio</h2><p>I developed the sliding number tiles game (shown below) as a small desktop software using Visual Studio.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/l9iasejgl73xuj6bxkt7.PNG" alt="Alt Text"></p>
<p>This video shows how I solve the game manually (I am not quite good at it):</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/kU1aec4fqfc" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<h2 id="Solving-it-using-A"><a href="#Solving-it-using-A" class="headerlink" title="Solving it using A*"></a>Solving it using A*</h2><p>Now I touch “S”-key of my keyboard, and the A* algorithm starts to solve the puzzle (search a path). And I push “S”-key again, it starts to show the solution.</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/tsv5wD8s2Ks" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<p>The code has been pushed to <a target="_blank" rel="noopener" href="https://github.com/jemaloQ/astar_search_game.git">this repo</a>. </p>
<p>Below are simple explanations of the algorithm in this example.</p>
<h2 id="Algorithm-explanation"><a href="#Algorithm-explanation" class="headerlink" title="Algorithm explanation"></a>Algorithm explanation</h2><h3 id="Node-and-graph"><a href="#Node-and-graph" class="headerlink" title="Node and graph"></a>Node and graph</h3><p>Each configuration of this game corresponds to a node in its state graph as shown below. So in order to solve this game, we need to find a path that links node start to node target via a sequence of intermediate nodes.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/z65q1qk594ahgpippp6a.PNG" alt="Alt Text"></p>
<h3 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h3><p>We assure that the <strong>assumptions</strong> are satisfied in this example: </p>
<ol>
<li>there are limited number of states; </li>
<li>there is a valid heuristic function for assessing the distance between nodes: sum of distance (in number of moves) for each tile from its current position to its target position</li>
</ol>
<h3 id="Some-conceptions"><a href="#Some-conceptions" class="headerlink" title="Some conceptions:"></a>Some conceptions:</h3><p><strong>Closed set</strong>: a set of nodes that has been assessed<br><strong>Frontier set</strong>: a set of nodes that are about to be explored</p>
<h3 id="StateNode-class"><a href="#StateNode-class" class="headerlink" title="StateNode class"></a>StateNode class</h3><p>Each state node object in the code has value members:<br><strong>parent</strong>: a node from which current node comes with one move<br><strong>g</strong>: path cost from <strong>start</strong> node to current node<br><strong>h</strong>: distance cost from current node to <strong>target</strong> node<br><strong>isExpanded</strong>: a flag noting if all neighbors of this node are in <strong>Closed set</strong></p>
<h3 id="Algorithm-pseudo-code-details"><a href="#Algorithm-pseudo-code-details" class="headerlink" title="Algorithm pseudo-code details:"></a>Algorithm pseudo-code details:</h3><p><strong>Init</strong>: put start node into closed set and frontier set</p>
<p><strong>Explore_node</strong> for a given node:</p>
<p>I have developed the core function of this algorithm <em>explore_Tree</em>(<strong>n_i</strong>) and it do the following works in a recursive way:<br>    (1) for each neighbor nodes <strong>n_k</strong> of node <strong>n_i</strong>, check firstly if <strong>n_k</strong> is already included in closed set.<br>    (2) If we get YES for step 1, and if current cost of <strong>n_k</strong> (namely: <strong>g+h</strong>) is lower than its cost in the <strong>closed set</strong>, update its cost and update its parent as <strong>n_i</strong>;<br>    (3) If we get NO for step 1: put current node <strong>n_k</strong> into <strong>frontier</strong> and <strong>closed set</strong>, calculate its cost, define <strong>n_k</strong>‘s parent as <strong>n_i</strong><br>    (4) delete <strong>n_i</strong> from <strong>frontier set</strong><br>    (5) check if any node in <strong>frontier</strong> has reached target node<br>    (6) if target reached, return True<br>    (7) if target not yet reached, select <strong>node of the lowest cost from frontier set</strong>, and call function <em>explore_Tree()</em> for it.</p>
<p>If <strong>Explore_node</strong> finally returns True, it means that the optimal path is found. We can then retrieve the path by tracking recursively the parent, starting from the target node.</p>
<h3 id="Illustration"><a href="#Illustration" class="headerlink" title="Illustration"></a>Illustration</h3><p>The following image shows the first step of this algorithm: exploring neighbors of the start node and assessing the cost of each node.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/mo16qo6j52ir6n6d0gpn.PNG" alt="Alt Text"></p>
<p>Following the step shown above, the image below shows the how A* explores recursively the “optimal” move. In this step, it locates the lowest-cost node in frontier then explores its neighbors and assesses their cost. </p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/2fj62u79o04fh8g64pxh.PNG" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/11/3D-character-motion-control-via-WebSocket/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/11/3D-character-motion-control-via-WebSocket/" class="post-title-link" itemprop="url">3D character motion control via WebSocket</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-11 10:28:38 / Modified: 10:35:25" itemprop="dateCreated datePublished" datetime="2021-01-11T10:28:38+01:00">2021-01-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/web/" itemprop="url" rel="index"><span itemprop="name">web</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Several days ago, a friend of mine contacted me and asked me the feasibility of a technical solution for a 3d human character simulation in HTML5 environment. He sent me <a target="_blank" rel="noopener" href="https://tympanus.net/codrops/2019/10/14/how-to-create-an-interactive-3d-character-with-three-js/">this article</a> which presents how to create an interactive 3d character with <strong>Three.js**</strong>. He is expecting to control the character’s real-time motion (whole-body motion) via a hardware such like a joystick. </p>
<p>It’s a very interesting work and it seems quite easy. Thus I have done a little dev work trying to make it work.  </p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/pvkgt00b7owyfr82zcpr.PNG" alt="Alt Text"></p>
<p>In file <code>Index.html</code>, I have defined a <code>websocket</code> server and an according message parser. This file then is wrapped in <code>Electron</code> window so it runs as a desktop software.<br>Core part of this <code>Index.html</code> is the <code>websocket</code> communication part as below:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line">&lt;script  type=<span class="string">&quot;text/javascript&quot;</span> &gt;</span><br><span class="line">	<span class="keyword">var</span> angle1 = <span class="number">0.0</span>;</span><br><span class="line">	<span class="keyword">var</span> angle2 = <span class="number">0.0</span></span><br><span class="line">	</span><br><span class="line">	<span class="keyword">const</span> qEvent = <span class="keyword">new</span> Event(<span class="string">&#x27;qiu&#x27;</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="comment">/* for debug */</span>    </span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">output</span>(<span class="params">s</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;</span><br><span class="line">		<span class="keyword">var</span> out = <span class="built_in">document</span>.getElementById(<span class="string">&quot;debug-area&quot;</span>);</span><br><span class="line">		out.innerText += s;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	output(<span class="string">&quot;Start running&quot;</span>)</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> msg_ready = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">var</span> msg_reading = <span class="literal">false</span>;  <span class="comment">// True: package head 0xAA is received, but 0x7f has not yet been received</span></span><br><span class="line">	<span class="keyword">var</span> msg_data_buffer = [];</span><br><span class="line">	<span class="keyword">var</span> msg_lenth = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">processMsg</span>(<span class="params">v</span>)</span></span><br><span class="line"><span class="function">	</span>&#123;		</span><br><span class="line">	<span class="keyword">if</span> (v[<span class="number">0</span>] == <span class="number">170</span>) <span class="comment">// detect the beginning byte of a message: 0xAA</span></span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// data are sent in little endian, </span></span><br><span class="line">		<span class="comment">// v.buffer is a byte-array and Int16Array(v.buffer, 8, 1) means that it parses from the 8th byte on to get ONE Int16 number</span></span><br><span class="line">               </span><br><span class="line">		<span class="keyword">if</span> ( (v[<span class="number">1</span>] == <span class="number">0x01</span>) &amp;&amp; (v[<span class="number">2</span>] == <span class="number">0x53</span>) ) <span class="comment">// 01 52</span></span><br><span class="line">		&#123;</span><br><span class="line">			angle1 = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(v.buffer, <span class="number">8</span>, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">			angle2 = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(v.buffer, <span class="number">10</span>, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">			<span class="keyword">var</span> temp3 = <span class="keyword">new</span> <span class="built_in">Int16Array</span>(v.buffer, <span class="number">12</span>, <span class="number">1</span>)[<span class="number">0</span>];</span><br><span class="line">			<span class="built_in">document</span>.dispatchEvent(qEvent);</span><br><span class="line"></span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">else</span> </span><br><span class="line">		&#123;</span><br><span class="line">		&#125;</span><br><span class="line">	 &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> ws = <span class="built_in">require</span>(<span class="string">&quot;nodejs-websocket&quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> clients =  <span class="keyword">new</span> <span class="built_in">Array</span>();</span><br><span class="line">	output(<span class="string">&quot;开始建立连接... &quot;</span>);</span><br><span class="line">	<span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">var</span> data = <span class="keyword">new</span> Buffer.alloc(<span class="number">0</span>);</span><br><span class="line">	<span class="keyword">var</span> server = ws.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">conn</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		conn.id = count;</span><br><span class="line">		count += <span class="number">1</span>;</span><br><span class="line">		clients[<span class="string">&quot;conn&quot;</span>+count]  = conn;</span><br><span class="line"></span><br><span class="line">		conn.on(<span class="string">&quot;text&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">str</span>) </span>&#123;</span><br><span class="line">			output(<span class="string">&quot;Received &quot;</span> + str + <span class="string">&quot;! &quot;</span> )</span><br><span class="line">			<span class="keyword">var</span> typeId = str.charAt(<span class="number">0</span>);			</span><br><span class="line">			conn.sendText(<span class="string">&#x27;Success!&#x27;</span>);</span><br><span class="line">		&#125;)</span><br><span class="line">		conn.on(<span class="string">&quot;close&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code, reason</span>) </span>&#123;</span><br><span class="line">			output(<span class="string">&quot;Connection closed!&quot;</span>)</span><br><span class="line">			<span class="comment">//clients.delete(conn);</span></span><br><span class="line">		&#125;);</span><br><span class="line">		</span><br><span class="line">		conn.on(<span class="string">&quot;binary&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">inStream</span>) </span>&#123;</span><br><span class="line">		</span><br><span class="line">			inStream.on(<span class="string">&quot;readable&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">				<span class="keyword">var</span> newData = inStream.read();</span><br><span class="line">				</span><br><span class="line">				<span class="keyword">if</span> (newData)</span><br><span class="line">					data = Buffer.concat([data, newData], data.length + newData.length);</span><br><span class="line">			&#125;);</span><br><span class="line">			</span><br><span class="line">			inStream.on(<span class="string">&quot;end&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span>(data)&#123;</span><br><span class="line">				<span class="keyword">var</span> t = <span class="string">&#x27;&#x27;</span>, v = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(data);</span><br><span class="line"></span><br><span class="line">				<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; v.length; i++)</span><br><span class="line">				&#123;</span><br><span class="line">					<span class="comment">// packet head 0xAA reached, now start reading the data flow</span></span><br><span class="line">					<span class="keyword">if</span>  ((!msg_reading ) &amp;&amp;(v[i] == <span class="number">0xaa</span>))&#123;</span><br><span class="line">						msg_reading = <span class="literal">true</span>;</span><br><span class="line">					&#125;</span><br><span class="line">					</span><br><span class="line">					</span><br><span class="line">					<span class="keyword">if</span>(msg_reading)&#123;</span><br><span class="line">						</span><br><span class="line">						<span class="keyword">if</span> (msg_data_buffer.length == <span class="number">8</span>) &#123;</span><br><span class="line">							msg_lenth =  msg_data_buffer[<span class="number">5</span>]*<span class="number">16</span> + msg_data_buffer[<span class="number">4</span>]; <span class="comment">// parsing the data length (bytes size)							</span></span><br><span class="line">						&#125;</span><br><span class="line">						</span><br><span class="line">						<span class="comment">// received the end of packet, and the length is correct </span></span><br><span class="line">						<span class="keyword">if</span> ((v[i] == <span class="number">127</span> ) &amp;&amp; (msg_data_buffer.length == (msg_lenth + <span class="number">10</span>)))  <span class="comment">// 10 extra bytes contained in this package for : length, scope, checksum, msg-id </span></span><br><span class="line">						&#123;							</span><br><span class="line">							<span class="keyword">var</span> msg = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(msg_data_buffer);</span><br><span class="line">							processMsg(msg);</span><br><span class="line">							msg_data_buffer = [];</span><br><span class="line">							msg_reading = <span class="literal">false</span>;</span><br><span class="line">							msg_lenth = <span class="number">0</span>;</span><br><span class="line">						&#125; <span class="keyword">else</span> <span class="keyword">if</span> (msg_data_buffer.length == (msg_lenth + <span class="number">10</span>))</span><br><span class="line">						&#123;</span><br><span class="line">							msg_data_buffer = [];</span><br><span class="line">							msg_reading = <span class="literal">false</span>;</span><br><span class="line">							msg_lenth = <span class="number">0</span>;</span><br><span class="line">							output(<span class="string">&quot;Message length error!&quot;</span>);</span><br><span class="line">						&#125;</span><br><span class="line">						<span class="keyword">else</span>&#123;</span><br><span class="line">							msg_data_buffer.push(v[i]);</span><br><span class="line">						&#125;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">									</span><br><span class="line">			&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">				</span><br><span class="line">			&#125;;</span><br><span class="line">			data = <span class="keyword">new</span> Buffer.alloc(<span class="number">0</span>);</span><br><span class="line">			conn.sendText(<span class="string">&#x27;Binary Received!&#x27;</span>);</span><br><span class="line">			&#125;);</span><br><span class="line">			</span><br><span class="line">			</span><br><span class="line">		&#125;);</span><br><span class="line">		conn.on(<span class="string">&quot;message&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code, reason</span>) </span>&#123;</span><br><span class="line">			output(<span class="string">&quot;message! &quot;</span> )</span><br><span class="line">		&#125;);</span><br><span class="line">		conn.on(<span class="string">&quot;error&quot;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code, reason</span>) </span>&#123;</span><br><span class="line">			output(<span class="string">&quot;Error occurs!&quot;</span>)</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;).listen(<span class="number">9999</span>)</span><br><span class="line">	output(<span class="string">&quot;Server is ready! &quot;</span>);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>
<p>In existing file script.js, I have defined function <code>moveOneJoint()</code>. For the moment for test only, this function change only the orientation of the head (namely <em>neck</em> joint). It will be called each time an event ‘qiu’ is dispatched.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">document</span>.addEventListener(<span class="string">&#x27;qiu&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span> (neck &amp;&amp; waist) &#123;</span><br><span class="line">     moveOneJoint(neck, angle1, angle2);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">moveOneJoint</span>(<span class="params">joint, x, y</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  joint.rotation.y = THREE.Math.degToRad(x);</span><br><span class="line">  joint.rotation.x = THREE.Math.degToRad(y);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Entire code has been pushed to github repo:<br><a target="_blank" rel="noopener" href="https://github.com/QiuZhaopeng/3d_character_simulation">https://github.com/QiuZhaopeng/3d_character_simulation</a></p>
<p>I do not have a joystick so I simulate it with several range sliders in another web app (developed using <code>MUI</code> framework with <code>HBuilder</code>). By sliding the sliders, we can send the angle data via <code>websocket</code> to above-mentioned 3d character simulator. Data massage to be sent should be a dataarray like: <code>[0xAA,  0x01,0x53,  0x01,  0x04,0x00,0x00,0x00,   0xMM,0xNN, 0xSS,0xTT,  0xYY,0xZZ,   0x7F]</code> where  <code>0xMM,0xNN</code> and <code>0xSS,0xTT</code> are angle values in <code>Int16</code> and <code>0xYY,0xZZ</code> can be any bytes (designed to be checksum, but I am not checking it in my code).</p>
<p>Below is a demo I’ve recorded. I am controlling the motion of the simulated 3d character’s head using sliders:</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/86ssL2uVxjc" frameborder="0" loading="lazy" allowfullscreen></iframe></div>


<p>In another trial, I run my device simulator app on Android platform and run <code>Electron</code> in full screen. Check out the demo :</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/Zb-ESbjVnos" frameborder="0" loading="lazy" allowfullscreen></iframe></div>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/10/Julia-Tutorial-1-Context-and-basics/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/10/Julia-Tutorial-1-Context-and-basics/" class="post-title-link" itemprop="url">Julia Tutorial - 1: Context and basics</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-10 17:05:13 / Modified: 17:36:11" itemprop="dateCreated datePublished" datetime="2021-01-10T17:05:13+01:00">2021-01-10</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data/" itemprop="url" rel="index"><span itemprop="name">Data</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h2><p>A super fan of <strong>Matlab</strong>, I’ve used it (mainly the <em>Optimization</em> toolbox) a lot during my PhD study. Later on, after I started my professional job in <em>INRIA</em> and <em>GE</em>, I used mainly <strong>C++/C/C#/Python</strong> but rarely <em>Matlab</em>. Though <em>Matlab</em> is great, it is, however, too expensive for personal users. That’s why I use often open-source tools such like <strong>Numpy</strong>, <strong>Scipy</strong>, <strong>Eigen</strong> and <strong>Maxima</strong> in some math-related development works.</p>
<p>I heard the name of <strong>Julia</strong> in 2017. I felt astonished to learn that this new language combines the interactivity and computational power of Python/Matlab with the speed of C. It is until winter of 2020 that I have time to learn intensively this powerful and promising language. So I would like to share my learning notes here. Stay hungry!</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/fth0mf5mdu9en2ayl7ky.png" alt="Alt Text"></p>
<h2 id="Numbers"><a href="#Numbers" class="headerlink" title="Numbers"></a>Numbers</h2><p>For <code>Number</code> type of <strong>Julia</strong>, this table in figure below presents the common basic types:<br> <img src="https://dev-to-uploads.s3.amazonaws.com/i/ul5g1apbhlt8sgzmhh56.PNG" alt="Alt Text"></p>
<p>I have made a “Knowldge graph” of all data types in <strong>Julia</strong> and their relations. Below is a chart of all types (nodes) that are related to <code>Number</code>type:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/q3q6zwuwsb2scw9winyf.PNG" alt="Alt Text"></p>
<p>My exercise code </p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#     one &#x27;#&#x27; symbole for a one-line comment, equal to // in C/C++</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#=    &#x27;#=&#x27; + &#x27;=#</span>&#x27; pair <span class="keyword">for</span> multi-line comment</span><br><span class="line">      similar to &#x27;/*<span class="string">&#x27;+&#x27;</span>*/&#x27; pair <span class="keyword">in</span> C/C++</span><br><span class="line">=<span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## as in java, println(xxx) is equivalent to print(xxx + &#x27;\n&#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">########   day 1:   Numbers</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">println(<span class="string">&quot;a: &quot;</span>, a, <span class="string">&quot;,&quot;</span>, typeof(a))   <span class="comment">## Int64 if running on 64-bit CPU, Int32 for 32-bit CPU</span></span><br><span class="line"></span><br><span class="line">aa = <span class="built_in">UInt8</span>(<span class="number">1</span>)     <span class="comment"># method to convert to a specific type</span></span><br><span class="line">println(a == aa)</span><br><span class="line">println(sizeof(a), <span class="string">&quot;, &quot;</span> ,sizeof(aa))</span><br><span class="line"></span><br><span class="line">b = <span class="number">3.2</span></span><br><span class="line">println(<span class="string">&quot;b: &quot;</span>, b, <span class="string">&quot;,&quot;</span>, typeof(b))</span><br><span class="line">println(sizeof(b))</span><br><span class="line"></span><br><span class="line">c = <span class="number">1e18</span></span><br><span class="line">println(<span class="string">&quot;c: &quot;</span>, c, <span class="string">&quot;,&quot;</span>, typeof(c))</span><br><span class="line"></span><br><span class="line">d = <span class="number">0x3f</span></span><br><span class="line">println(<span class="string">&quot;d: &quot;</span>, d, <span class="string">&quot;,&quot;</span>, typeof(d))</span><br><span class="line"></span><br><span class="line">e = <span class="number">0b10</span> </span><br><span class="line">println(<span class="string">&quot;e: &quot;</span>, e, <span class="string">&quot;,&quot;</span>, typeof(e))</span><br><span class="line"></span><br><span class="line">f = <span class="number">0o057</span></span><br><span class="line">println(<span class="string">&quot;f: &quot;</span>, f, <span class="string">&quot;,&quot;</span>, typeof(f))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">g = <span class="string">&#x27;x&#x27;</span></span><br><span class="line">println(<span class="string">&quot;g: &quot;</span>, g, <span class="string">&quot;,&quot;</span>, typeof(g))</span><br><span class="line">println(<span class="string">&quot;g-1: &quot;</span>, g-<span class="number">1</span>, <span class="string">&quot;,&quot;</span>, typeof(g-<span class="number">1</span>))</span><br><span class="line">println(g == <span class="built_in">UInt8</span>(<span class="string">&#x27;x&#x27;</span>))</span><br><span class="line">g= convert( <span class="built_in">UInt8</span>, g)  <span class="comment"># convert function for converting types</span></span><br><span class="line">println(g == <span class="built_in">UInt8</span>(<span class="string">&#x27;x&#x27;</span>))</span><br><span class="line"></span><br><span class="line">h = <span class="number">2</span> + <span class="number">3</span><span class="literal">im</span></span><br><span class="line">println(<span class="string">&quot;h: &quot;</span>, h, <span class="string">&quot;, &quot;</span>, typeof(h))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">i = <span class="number">0.5</span>f</span><br><span class="line">println(<span class="string">&quot;i: &quot;</span>, i, <span class="string">&quot;, &quot;</span>, typeof(i))</span><br><span class="line"></span><br><span class="line">j = <span class="literal">Inf</span> - <span class="literal">Inf</span></span><br><span class="line">println(<span class="string">&quot;j: &quot;</span>, j, <span class="string">&quot;, &quot;</span>, typeof(j))</span><br><span class="line"></span><br><span class="line">k = <span class="literal">Inf</span> * <span class="number">0</span></span><br><span class="line">println(<span class="string">&quot;k: &quot;</span>, k, <span class="string">&quot;, &quot;</span>, typeof(k))</span><br><span class="line"></span><br><span class="line">l = <span class="number">2</span>/<span class="number">0</span></span><br><span class="line">println(<span class="string">&quot;l: &quot;</span>, l, <span class="string">&quot;, &quot;</span>, typeof(l))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = <span class="number">6</span>//<span class="number">9</span></span><br><span class="line"></span><br><span class="line">println(<span class="string">&quot;m: &quot;</span>, m, <span class="string">&quot;, &quot;</span>, typeof(m))</span><br><span class="line"></span><br><span class="line">n = bitstring(<span class="number">65535</span>)</span><br><span class="line">println(<span class="string">&quot;n: &quot;</span>, n, <span class="string">&quot;, &quot;</span>, typeof(n))</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Below is the output that I got:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/2d9go0ocsr5zqlz4rj2p.PNG" alt="Alt Text"> </p>
<p>Official Website:<br><a target="_blank" rel="noopener" href="https://julialang.org/">https://julialang.org/</a></p>
<p>Cheat sheet:<br><a target="_blank" rel="noopener" href="https://juliadocs.github.io/Julia-Cheat-Sheet/">https://juliadocs.github.io/Julia-Cheat-Sheet/</a><br><a target="_blank" rel="noopener" href="https://juliadocs.github.io/Julia-Cheat-Sheet/zh-cn/">https://juliadocs.github.io/Julia-Cheat-Sheet/zh-cn/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/08/Simple-GAN-Network-practice-using-Tensorflow-v2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/08/Simple-GAN-Network-practice-using-Tensorflow-v2/" class="post-title-link" itemprop="url">Simple GAN Network practice using Tensorflow v2</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-08 13:02:16 / Modified: 15:01:54" itemprop="dateCreated datePublished" datetime="2021-01-08T13:02:16+01:00">2021-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>I have browsed this video on youtube homepage by chance today: <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=yYUN_k36u5Q">https://www.youtube.com/watch?v=yYUN_k36u5Q</a>. This tutorial talks about building a <strong>GAN (Generative Adversarial Nets)</strong> network using <strong>PyTorch</strong> and it is quite interesting and simple. Thus I cloned his <em>github</em> source file and updated it a little bit so that it runs with <strong>Tensorflow 2</strong>. </p>
<p>In this example here in my post, a <em>REAL</em> artist can draw wonderful “paintings” of his own style, which are parabolas that are inside the gray area in figure below and are parallel to the blue and red parabolas.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/1trq05ce9zr51tsx8znk.png" alt="Alt Text"></p>
<p>Then we introduce a <strong>GAN</strong> network where a generator and a discriminator are defined. The Generator model shall try to simulate the oeuvres of the artist as well as possible. The structure of this <strong>Generator</strong> model is as shown below:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/ttbm9n9sk9ex9pmidkil.png" alt="Alt Text"></p>
<p>The <strong>Discriminator</strong> model, on contrary, shall do its best to distinguish the generated paintings and the REAL paintings. Its structure is as shown below:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/6igys3g2u25ax3g5gice.png" alt="Alt Text"></p>
<p>Now let’s begin to code.</p>
<p>Firstly the dependencies. One should have <strong>tensorflow 2</strong>, <strong>numpy</strong> and <strong>matplotlib</strong> installed.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">&#x27;TF_CPP_MIN_LOG_LEVEL&#x27;</span>] = <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf2</span><br><span class="line"><span class="keyword">import</span> tensorflow.keras <span class="keyword">as</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Sequential</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Dense, Activation</span><br><span class="line"><span class="keyword">import</span> tensorflow.keras.backend <span class="keyword">as</span> K</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;TF version: &quot;</span>, tf2.__version__)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>Some important hyper parameters.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hyper Parameters</span></span><br><span class="line">BATCH_SIZE = <span class="number">32</span></span><br><span class="line">LR_G = <span class="number">0.0001</span>           <span class="comment"># learning rate for generator</span></span><br><span class="line">LR_D = <span class="number">0.0001</span>           <span class="comment"># learning rate for discriminator</span></span><br><span class="line">N_IDEAS = <span class="number">5</span>             <span class="comment"># think of this as number of ideas for generating an art work (Generator)</span></span><br><span class="line">ART_COMPONENTS = <span class="number">15</span>     <span class="comment"># it could be total point G can draw in the canvas</span></span><br><span class="line">PAINT_POINTS = np.vstack([np.linspace(-<span class="number">1</span>, <span class="number">1</span>, ART_COMPONENTS) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(BATCH_SIZE)])</span><br></pre></td></tr></table></figure>
<p>This function will return painting works of the real artist:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment"># return painting of the famous artist (real target)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">artist_works</span>():</span>    </span><br><span class="line">    a = np.random.uniform(<span class="number">1</span>, <span class="number">2</span>, size=BATCH_SIZE)[:, np.newaxis]</span><br><span class="line">    paintings = a * np.power(PAINT_POINTS, <span class="number">2</span>) + (a-<span class="number">1</span>)</span><br><span class="line">    <span class="comment"># print(&quot;Shape of paitings: &quot;, paintings.shape)</span></span><br><span class="line">    <span class="keyword">return</span> paintings</span><br></pre></td></tr></table></figure>
<p>Now the models as well as their optimizers.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">model_G = Sequential([</span><br><span class="line">    Dense(<span class="number">128</span>, activation=<span class="string">&quot;relu&quot;</span>,input_shape=(<span class="literal">None</span>, N_IDEAS)), </span><br><span class="line">    Dense(ART_COMPONENTS)</span><br><span class="line">])</span><br><span class="line"></span><br><span class="line">model_D = Sequential([</span><br><span class="line">    Dense(<span class="number">128</span>, activation=<span class="string">&quot;relu&quot;</span>, input_shape=(<span class="literal">None</span>, ART_COMPONENTS)),  </span><br><span class="line">    Dense(<span class="number">1</span>, activation=<span class="string">&quot;sigmoid&quot;</span>),</span><br><span class="line">    ])</span><br><span class="line"></span><br><span class="line">opt_D = keras.optimizers.Adam(model_D.variables, lr=LR_D)</span><br><span class="line">opt_G = keras.optimizers.Adam(model_G.variables, lr=LR_G)</span><br></pre></td></tr></table></figure>
<p>Finally the training part and the plot stuffs. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">          </span><br><span class="line">plt.ion()   <span class="comment"># something about continuous plotting</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> step <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10000</span>):</span><br><span class="line">    artist_paintings = artist_works()  <span class="comment"># real painting from artist</span></span><br><span class="line">    G_ideas = np.random.randn(BATCH_SIZE, N_IDEAS)</span><br><span class="line">    <span class="keyword">with</span> tf2.GradientTape(persistent=<span class="literal">True</span>) <span class="keyword">as</span> tape:</span><br><span class="line">        G_paintings = model_G(G_ideas)                    <span class="comment"># fake painting from model G (random ideas)</span></span><br><span class="line">        prob_artist1 = model_D(G_paintings)               <span class="comment"># model D computes the prob for assessing if G_paintings are real</span></span><br><span class="line">        G_loss = K.mean(K.log(<span class="number">1.</span> - prob_artist1))         <span class="comment"># loss function of G model</span></span><br><span class="line"></span><br><span class="line">     </span><br><span class="line">        prob_artist0 = model_D(artist_paintings)          <span class="comment"># D try to increase this prob for real paitings</span></span><br><span class="line">        prob_artist1 = model_D(G_paintings)  <span class="comment"># D try to reduce this prob for generated paitings</span></span><br><span class="line">        D_loss = - K.mean(K.log(prob_artist0) + K.log(<span class="number">1.</span> - prob_artist1))                               <span class="comment"># loss function of G model</span></span><br><span class="line">    </span><br><span class="line">    L_gradx = tape.gradient(G_loss, model_G.variables)   </span><br><span class="line">    opt_G.apply_gradients(grads_and_vars=<span class="built_in">zip</span>(L_gradx, model_G.variables))</span><br><span class="line">    </span><br><span class="line">    L_gradx2 = tape.gradient(D_loss, model_D.variables) </span><br><span class="line">    opt_D.apply_gradients(grads_and_vars=<span class="built_in">zip</span>(L_gradx2, model_D.variables))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> step % <span class="number">50</span> == <span class="number">0</span>:  <span class="comment"># plotting</span></span><br><span class="line">        plt.cla()</span><br><span class="line">        plt.plot(PAINT_POINTS[<span class="number">0</span>], G_paintings[<span class="number">0</span>], c=<span class="string">&#x27;#4AD631&#x27;</span>, lw=<span class="number">3</span>, label=<span class="string">&#x27;Generated painting&#x27;</span>,)</span><br><span class="line">        plt.plot(PAINT_POINTS[<span class="number">0</span>], <span class="number">2</span> * np.power(PAINT_POINTS[<span class="number">0</span>], <span class="number">2</span>) + <span class="number">1</span>, c=<span class="string">&#x27;#74BCFF&#x27;</span>, lw=<span class="number">3</span>, label=<span class="string">&#x27;upper bound&#x27;</span>)</span><br><span class="line">        plt.plot(PAINT_POINTS[<span class="number">0</span>], <span class="number">1</span> * np.power(PAINT_POINTS[<span class="number">0</span>], <span class="number">2</span>) + <span class="number">0</span>, c=<span class="string">&#x27;#FF9359&#x27;</span>, lw=<span class="number">3</span>, label=<span class="string">&#x27;lower bound&#x27;</span>)</span><br><span class="line">        plt.text(-<span class="number">.5</span>, <span class="number">2.3</span>, <span class="string">&#x27;D accuracy=%.2f (0.5 for D to converge)&#x27;</span> % K.mean(prob_artist0), fontdict=&#123;<span class="string">&#x27;size&#x27;</span>: <span class="number">13</span>&#125;)</span><br><span class="line">        plt.text(-<span class="number">.5</span>, <span class="number">2</span>, <span class="string">&#x27;D score= %.2f (-1.38 for G to converge)&#x27;</span> % -D_loss, fontdict=&#123;<span class="string">&#x27;size&#x27;</span>: <span class="number">13</span>&#125;)</span><br><span class="line">        plt.ylim((<span class="number">0</span>, <span class="number">3</span>));plt.legend(loc=<span class="string">&#x27;upper right&#x27;</span>, fontsize=<span class="number">10</span>);plt.draw();plt.pause(<span class="number">0.01</span>)</span><br><span class="line">        print(<span class="string">&quot;Current step: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(step))</span><br><span class="line">plt.ioff()</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<p>See how the simulated painting evolves:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/a5hzr7aya5hgkt7g4iuh.PNG" alt="Alt Text"></p>
<p>As we can see, as the training steps increases, the “generated paintings” in green becomes more and more real: it becomes quite parallel to upper and lower limit parabolas and stays inside the limits.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/08/MapReduce-in-Python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/08/MapReduce-in-Python/" class="post-title-link" itemprop="url">MapReduce in Python</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-08 11:25:49 / Modified: 15:02:44" itemprop="dateCreated datePublished" datetime="2021-01-08T11:25:49+01:00">2021-01-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Data/" itemprop="url" rel="index"><span itemprop="name">Data</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Map-Reduce-in-Python"><a href="#Map-Reduce-in-Python" class="headerlink" title="Map / Reduce in Python"></a>Map / Reduce in Python</h1><p>To understand the concept, please refer to this paper of Google: <a target="_blank" rel="noopener" href="http://research.google.com/archive/mapreduce.html">link</a></p>
<p>In python 2, <code>map()</code> and <code>reduce()</code> are both built-in functions. However, since Python3, <code>reduce()</code> is no longer a built-in function, one should import it from <code>functools</code> module.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/4rs1h2d3ygevfb607m7f.PNG" alt="Alt Text"></p>
<p><code>map()</code> applies a function to all the items in an input list and returns an iterator object. Such like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt; a = <span class="built_in">map</span>(<span class="keyword">lambda</span> x:x+x, [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>])</span><br><span class="line">&gt;&gt; <span class="built_in">list</span>(a)</span><br><span class="line">Out: [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>]</span><br></pre></td></tr></table></figure>
<p><code>reduce()</code> performs a rolling computation to sequential pairs of values in an input list and returning the result.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/w8c8qt1605q2k71pgg05.png" alt="Alt Text"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)</span><br></pre></td></tr></table></figure>
<p>Here is an example written by myself today:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce <span class="comment"># only in Python 3</span></span><br><span class="line"></span><br><span class="line">DIGITS = &#123;<span class="string">&#x27;0&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;1&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;2&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>: <span class="number">3</span>, <span class="string">&#x27;4&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;5&#x27;</span>: <span class="number">5</span>, <span class="string">&#x27;6&#x27;</span>: <span class="number">6</span>, <span class="string">&#x27;7&#x27;</span>: <span class="number">7</span>, <span class="string">&#x27;8&#x27;</span>: <span class="number">8</span>, <span class="string">&#x27;9&#x27;</span>: <span class="number">9</span>,<span class="string">&#x27;.&#x27;</span>: -<span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">char2num</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> DIGITS[s] </span><br><span class="line">    </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2float</span>(<span class="params">s</span>):</span> </span><br><span class="line">    L = <span class="built_in">map</span>(char2num, s)</span><br><span class="line">    r = reduce(func,L)</span><br><span class="line">    print(r)</span><br><span class="line">    <span class="keyword">return</span> r[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">x, y</span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(x) == <span class="built_in">int</span>:</span><br><span class="line">        <span class="keyword">if</span> x == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">0</span> + y, <span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">elif</span> y == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span>(x, <span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> (x*<span class="number">10</span>+y, <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(x) == <span class="built_in">tuple</span>:</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> y == -<span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span>(x[<span class="number">0</span>], <span class="number">0.1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> x[<span class="number">1</span>]&lt; <span class="number">1</span>:</span><br><span class="line">                res = x[<span class="number">1</span>]*<span class="number">0.1</span></span><br><span class="line">                <span class="keyword">return</span>(x[<span class="number">0</span>]+y*x[<span class="number">1</span>], res)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                res = <span class="number">1</span></span><br><span class="line">                <span class="keyword">return</span>(x[<span class="number">0</span>]*<span class="number">10</span>+y, res)</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#print(&#x27;str2float(\&#x27;123.456\&#x27;) =&#x27;, str2float(&#x27;123.456&#x27;))</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(str2float(<span class="string">&#x27;123.4&#x27;</span>) - <span class="number">123.4</span>) &lt; <span class="number">0.00001</span>:</span><br><span class="line">        print(<span class="string">&#x27;测试成功!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;测试失败!&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(str2float(<span class="string">&#x27;123456&#x27;</span>) - <span class="number">123456</span>) &lt; <span class="number">0.00001</span>:</span><br><span class="line">        print(<span class="string">&#x27;测试成功!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;测试失败!&#x27;</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">abs</span>(str2float(<span class="string">&#x27;0.123456&#x27;</span>) - <span class="number">0.123456</span>) &lt; <span class="number">0.00001</span>:</span><br><span class="line">        print(<span class="string">&#x27;测试成功!&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">&#x27;测试失败!&#x27;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>reference:</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/1016959663602400/1017329367486080">https://www.liaoxuefeng.com/wiki/1016959663602400/1017329367486080</a></li>
<li><a target="_blank" rel="noopener" href="https://book.pythontips.com/en/latest/map_filter.html">https://book.pythontips.com/en/latest/map_filter.html</a></li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhaopeng QIU"
      src="/images/qiu.png">
  <p class="site-author-name" itemprop="name">Zhaopeng QIU</p>
  <div class="site-description" itemprop="description">Stay hungry, stay foolish</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">11</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhaopeng QIU</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>
