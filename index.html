<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"qiuzhaopeng.github.io","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="Stay hungry, stay foolish">
<meta property="og:type" content="website">
<meta property="og:title" content="Zhaopeng&#39;s Homepage">
<meta property="og:url" content="http://qiuzhaopeng.github.io/index.html">
<meta property="og:site_name" content="Zhaopeng&#39;s Homepage">
<meta property="og:description" content="Stay hungry, stay foolish">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zhaopeng QIU">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://qiuzhaopeng.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Zhaopeng's Homepage</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Zhaopeng's Homepage</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">My tech notebook</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    

  <a href="https://github.com/QiuZhaopeng" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/02/26/Testing-Web-Apps-using-httpie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/26/Testing-Web-Apps-using-httpie/" class="post-title-link" itemprop="url">Testing Web Apps using httpie</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-26 10:07:58 / Modified: 10:13:09" itemprop="dateCreated datePublished" datetime="2021-02-26T10:07:58+01:00">2021-02-26</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IT/" itemprop="url" rel="index"><span itemprop="name">IT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Earlier this year, I have managed the development of a WebApp for industrial supplychain sourcing in our start-up . It’s a typical B/S-architecture project whose server side was entirely developed by myself (Ubuntu running over AliCloud + Django + Neo4j + MongoDB + Docker + Tomcat + nginx + other dependences).</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/b8ng553af9rbp72kngw1.PNG" alt="Alt Text"></p>
<p>Below are some notes about a simple tool called <strong>httpie</strong> that I used for testing my APIs. These notes were taken in Chinese, however I add also simple translation in English in case someone happens to read this post and wants to understand it. </p>
<p>可以使用pip安装(installing using <code>pip</code> with a specified source)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install --upgrade httpie -i http:&#x2F;&#x2F;pypi.douban.com&#x2F;simple --trusted-host pypi.douban.com</span><br></pre></td></tr></table></figure>
<p>测试get请求(testing a <code>GET</code> request)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http -v GET http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;suppliers_server&#x2F;get_user?username&#x3D;qiu</span><br></pre></td></tr></table></figure>
<p>测试POST带表单请求(testing a <code>POST</code> request)：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http --form POST http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;suppliers_server&#x2F;query_login username&#x3D;&quot;qiu&quot; password&#x3D;&quot;123456&quot;</span><br></pre></td></tr></table></figure><br>测试get请求带cookie(testing a <code>GET</code> request containing <code>cookie</code>)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http -v GET http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;corporadb&#x2F;login  Cookie:sessionid&#x3D;vc1d2m5kb1zul63l9g24qq5w58vfj35g</span><br></pre></td></tr></table></figure>
<p>将token包含在header中(testing a <code>GET</code> request containing <code>token</code>)：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http -v GET http:&#x2F;&#x2F;127.0.0.1:8000&#x2F;suppliers_server&#x2F;query_chain?product&#x3D;cd Cookie:sessionid&#x3D;y4nokqeymk54tdapicjjkmbve1qfuheo Authorization:eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VybmFtZSI6InFpdSJ9.qLDaly37vl77SxyHNPEqq6_HKzbSinmPcG9GvGQ-JdQ</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/02/23/Binary-search-algorithm-illustration%EF%BC%882%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/23/Binary-search-algorithm-illustration%EF%BC%882%EF%BC%89/" class="post-title-link" itemprop="url">Binary search algorithm illustration（2）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-02-23 16:09:54" itemprop="dateCreated datePublished" datetime="2021-02-23T16:09:54+01:00">2021-02-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-02-24 00:39:01" itemprop="dateModified" datetime="2021-02-24T00:39:01+01:00">2021-02-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Following <a target="_blank" rel="noopener" href="https://dev.to/jemaloqiu/binary-search-algorithm-illustration-1eaj">previous post</a>, I would like to illustrate the solution of the following problem (figure below) using <strong>Binary search algorithm</strong>.<br><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ttgsxr0iewkbpazpmlf9.PNG" alt="Alt Text"><br>As shown in the figure above, we are given a sorted array <strong>v</strong> =  [2, 2, 2, 3, 3, 4, 5, 6, 6, 7] with repeated numbers, and we want to find the index of the first occurrence of target number 3. It’s easy for human to find that the answer should be 3 (we suppose index of the first element is 0). How for computers?</p>
<h2 id="Algorithm-illustration"><a href="#Algorithm-illustration" class="headerlink" title="Algorithm illustration"></a>Algorithm illustration</h2><p>As usual, we define three pointers: <code>l</code>, <code>r</code> and <code>mid</code>. They point respectively to the lower (left) bound index, the upper (right) bound index and the middle index of the searching range. We calculate <code>mid</code> as <code>mid = l + (r-l)/2</code>.</p>
<p>Initially, we search the entire array. So <code>l</code> = 0, <code>r</code> = 9 and <code>mid</code> = 4. Here is the first step:<br><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/rutkm8mxo13137udql0q.png" alt="image"><br>Though <code>mid</code> points already to element whose value is equal to 3, we cannot stop searching since we are not sure if its the first occurrence in the array. So we continue to search by changing <code>r</code> to current value of <code>mid</code>. So we narrow down the searching range to the left half of the array:  <code>l</code> = 0, <code>r</code> = 4 and <code>mid</code> is updated to 2:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/scccki7gej68rjhmh0r9.PNG" alt="Alt Text"></p>
<p>Now the element pointed by <code>mid</code> is 2 and it is smaller than our target number 3. So we narrow down again the searching range to the right half of current searching range. Now  <code>l</code> = 3, <code>r</code> = 4 and <code>mid</code> is updated to 3:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/tnbjhphhej20bbasgcwv.PNG" alt="Alt Text"></p>
<p>Now the element pointed by <code>mid</code> is 3 and it is equal to the target number 3. We now move <code>r</code> to current <code>mid</code>. So <code>l</code> = <code>r</code> =  <code>mid</code> = 3. Solution found!</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/asay6bqrh7pgbw869jpf.PNG" alt="Alt Text"></p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>I put all the steps of this example in one figure to demonstrate overview of the solution:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/dwvrwrr9cce49i1y0t16.PNG" alt="Alt Text"></p>
<h2 id="C-Code"><a href="#C-Code" class="headerlink" title="C++ Code"></a>C++ Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* First occurency search </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">foSearch</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; <span class="built_in">array</span>, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="built_in">array</span>.size()<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l&lt;r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l + (r-l)/<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">array</span>[mid] &gt; target)</span><br><span class="line">        &#123;</span><br><span class="line">            r = mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(<span class="built_in">array</span>[mid] == target)</span><br><span class="line">        &#123;</span><br><span class="line">            r = mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            l = mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;l=&quot;</span> &lt;&lt; l &lt;&lt;  <span class="string">&quot;, r=&quot;</span> &lt;&lt; r &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">int</span> res = <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">array</span>[l] == target)</span><br><span class="line">    &#123;</span><br><span class="line">        res = l;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec &#123;<span class="number">1</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">4</span>,<span class="number">9</span>, <span class="number">9</span>,<span class="number">12</span>,<span class="number">12</span>, <span class="number">12</span>,<span class="number">32</span>,<span class="number">43</span>, <span class="number">43</span>,<span class="number">43</span>, <span class="number">55</span>, <span class="number">55</span>, <span class="number">63</span>, <span class="number">77</span>, <span class="number">77</span>, <span class="number">98</span>, <span class="number">98</span>, <span class="number">98</span>, <span class="number">100</span>&#125;;</span><br><span class="line">    <span class="keyword">int</span> ans = foSearch(vec, <span class="number">43</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;ans is : &quot;</span> &lt;&lt; ans &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">&quot;value is : &quot;</span> &lt;&lt; vec[ans] &lt;&lt; <span class="built_in">endl</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/02/23/Binary-search-algorithm-illustration/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/23/Binary-search-algorithm-illustration/" class="post-title-link" itemprop="url">Binary search algorithm illustration</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-23 00:20:01 / Modified: 00:21:11" itemprop="dateCreated datePublished" datetime="2021-02-23T00:20:01+01:00">2021-02-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CS/" itemprop="url" rel="index"><span itemprop="name">CS</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>“A picture is worth a thousand words”</p>
</blockquote>
<p>In order to explain to a friend how <strong>Binary search algorithm</strong> works, I drew several pictures to show solution of a simple problem using this algorithm. Here I would like to share it in this post. </p>
<p>As shown in the figure below, we are given a sorted array <strong>v</strong> = [1, 2, 3, 4, 5, 7, 9, 10, 12, 17], and we want to find index of the target number 9. One can see easily that the answer should be 6 (suppose index of the first element is 0).</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/7ku0opzveuhu22j1jel8.PNG" alt="Alt Text"></p>
<h2 id="Binary-search-algorithm-illustration"><a href="#Binary-search-algorithm-illustration" class="headerlink" title="Binary search algorithm illustration"></a>Binary search algorithm illustration</h2><p>In <strong>Binary search algorithm</strong>, we define three pointers to elements: <code>l</code>, <code>r</code> and <code>mid</code>. They point respectively to the lower (left) bound index, the upper (right) bound index and the middle index of the range for searching. We calculate <code>mid</code> as <code>mid = l + (r-l)/2</code>.</p>
<p>Initially, we search the entire array. So <code>l</code> = 0, <code>r</code> = 9 and <code>mid</code> = 4. Here is the first step:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ch8p4qfojxbbtn1i1t6d.PNG" alt="Alt Text"></p>
<p>The element pointed by <code>mid</code> is 5 and it is smaller than our target number 9. So we narrow down the searching range to the right half of the array:  <code>l</code> = <code>mid</code>+1 = 5, <code>r</code> = 9 and <code>mid</code> is updated 7:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ex6o0oh656j6q450f2x7.PNG" alt="Alt Text"></p>
<p>Now the element pointed by <code>mid</code> is 10 and it is larger than our target number 9. So we narrow down again the searching range to its left half. </p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/ci3m99kjafl12s5n7pg8.PNG" alt="Alt Text"></p>
<p>We repeat the same steps until the element pointed by <code>mid</code> is equal to the target number 9. See, we find out the index of number 9 in this array is 6.<br><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/wfihxwdc78nlntqrxix7.PNG" alt="Alt Text"></p>
<h2 id="Binary-search-algorithm-code"><a href="#Binary-search-algorithm-code" class="headerlink" title="Binary search algorithm code"></a>Binary search algorithm code</h2><p>Below is the c++ code for this algorithm:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* Binary search </span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binSearch</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; <span class="built_in">array</span>, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> l = <span class="number">0</span>, r = <span class="built_in">array</span>.size()<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">while</span> (l&lt;=r)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">int</span> mid = l + (r-l)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">array</span>[mid] == target)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> mid;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">array</span>[mid] &gt; target)</span><br><span class="line">        &#123;</span><br><span class="line">            r = mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            l = mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>I put all the steps of this example in one figure to demonstrate overview of the <strong>Binary search algorithm</strong>:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/gqm65k7cruocxc0kxcxu.png" alt="image"></p>
<h2 id="A-similar-problem"><a href="#A-similar-problem" class="headerlink" title="A similar problem"></a>A similar problem</h2><p>Here is a similar problem which can also be solved by varying a little the <strong>Binary search algorithm</strong>: in a sorted array with repeated elements, we would like to find index of the first occurrence of the target number. One can think of the solution. I will present the solution using figures in my next post. </p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/nyojhta92zf86jgqaci2.PNG" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/02/18/Implementation-of-Tensorflow-Lite-model-on-Android/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/18/Implementation-of-Tensorflow-Lite-model-on-Android/" class="post-title-link" itemprop="url">Implementation of Tensorflow Lite model on Android</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-18 23:38:24 / Modified: 23:41:12" itemprop="dateCreated datePublished" datetime="2021-02-18T23:38:24+01:00">2021-02-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Recently in some interview I have been asked about experience of implementing trained <strong>tensorflow</strong> models in android platform. I have tried one android project cloned from github which embedded a tflite model in it. However, I have not yet tried implementing my own model in an Android application. Thus I did such an exercise today and I successfully made my CNN model work on my Redmi Note 8 pro.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/am1dlr3zzlh786d15fn8.jpg" alt="Alt Text"></p>
<h2 id="CNN-model"><a href="#CNN-model" class="headerlink" title="CNN model"></a>CNN model</h2><p>Here is the code for training a <strong>CNN</strong> model with <code>mnist</code> dataset. This model then is converted as <code>tflite</code> model and shall be implemented in <strong>Android</strong> application for recognizing hand-write digits. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">&#x27;TF_CPP_MIN_LOG_LEVEL&#x27;</span>] = <span class="string">&quot;2&quot;</span></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"><span class="keyword">from</span> tensorflow <span class="keyword">import</span> keras</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> datasets, layers, optimizers, Sequential, metrics,models</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(x_train, y_train), (x_test, y_test) = tf.keras.datasets.mnist.load_data()</span><br><span class="line">print(x_train[<span class="number">0</span>,:,:])</span><br><span class="line"><span class="comment">## x_train.shape =&gt; (60000, 28, 28), y_train.shape =&gt; (60000,)</span></span><br><span class="line"><span class="comment">## x_test.shape =&gt; (10000, 28, 28), y_test.shape =&gt; (60000,)</span></span><br><span class="line">x_train = tf.expand_dims(x_train, -<span class="number">1</span>)</span><br><span class="line">x_test = tf.expand_dims(x_test, -<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">yt = tf.squeeze(y_train)  </span><br><span class="line"></span><br><span class="line">y_train = tf.squeeze(y_train)    </span><br><span class="line">y_test = tf.squeeze(y_test)</span><br><span class="line"></span><br><span class="line">print(<span class="string">&quot;Dataset info: &quot;</span>, x_train.shape, y_train.shape, x_test.shape, y_test.shape)</span><br><span class="line"></span><br><span class="line">batch_size = <span class="number">128</span></span><br><span class="line"></span><br><span class="line">train_db = tf.data.Dataset.from_tensor_slices((x_train, y_train))</span><br><span class="line">train_db = train_db.shuffle(<span class="number">10000</span>).batch(batch_size)</span><br><span class="line"></span><br><span class="line">test_db = tf.data.Dataset.from_tensor_slices((x_test, y_test))</span><br><span class="line">test_db = test_db.batch(batch_size)</span><br><span class="line"></span><br><span class="line">train_iter = <span class="built_in">iter</span>(train_db)</span><br><span class="line">sample = <span class="built_in">next</span>(train_iter)</span><br><span class="line">print(sample[<span class="number">0</span>].shape, sample[<span class="number">1</span>].shape)  </span><br><span class="line"></span><br><span class="line"><span class="comment">##  build a standard cnn model</span></span><br><span class="line">model = models.Sequential()</span><br><span class="line">model.add(layers.Conv2D(<span class="number">32</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>, input_shape=(<span class="number">28</span>, <span class="number">28</span>, <span class="number">1</span>)))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.MaxPooling2D((<span class="number">2</span>, <span class="number">2</span>)))</span><br><span class="line">model.add(layers.Conv2D(<span class="number">64</span>, (<span class="number">3</span>, <span class="number">3</span>), activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line"></span><br><span class="line">model.add(layers.Flatten())</span><br><span class="line">model.add(layers.Dense(<span class="number">64</span>, activation=<span class="string">&#x27;relu&#x27;</span>))</span><br><span class="line">model.add(layers.Dense(<span class="number">10</span>))</span><br><span class="line"></span><br><span class="line">model.summary()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">model.<span class="built_in">compile</span>(optimizer=<span class="string">&#x27;adam&#x27;</span>,</span><br><span class="line">              loss=tf.keras.losses.SparseCategoricalCrossentropy(from_logits=<span class="literal">True</span>),</span><br><span class="line">             metrics=[<span class="string">&#x27;accuracy&#x27;</span>])</span><br><span class="line"></span><br><span class="line">train_history = model.fit(train_db, epochs=<span class="number">10</span>,          validation_data=test_db)</span><br><span class="line"></span><br><span class="line"><span class="comment">## once the model has been trained, convert it to tflite model</span></span><br><span class="line">converter = tf.lite.TFLiteConverter.from_keras_model(model)</span><br><span class="line">tflite_model = converter.convert()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;qiu_mnist_model.tflite&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(tflite_model)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="Implementation-in-Android-app"><a href="#Implementation-in-Android-app" class="headerlink" title="Implementation in Android app"></a>Implementation in Android app</h2><p>I refereed to <a target="_blank" rel="noopener" href="https://margaretmz.medium.com/e2e-tfkeras-tflite-android-273acde6588">this post</a> for obtaining the original android project. I imported the kotlin version into my <strong>Android Studio</strong>. However, there were some bugs initially when I loaded my model into it. </p>
<p>My own model is located to <code>asset</code> repository:<br><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/b7dylong7y5s6dtsnasn.PNG" alt="Alt Text"></p>
<p>The most important thing for this work is the following Gradle setting:<br><img src="https://dev-to-uploads.s3.amazonaws.com/uploads/articles/khmpkno356geyn128vmn.PNG" alt="Alt Text"></p>
<p>After about 15min of debugging and code modifications, I successfully made my model work. </p>
<p>Check out the video (there is still accuracy issue):</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/yIQ6RJx90yM" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<p>I will upload the android project src code to my github repo once I finish cleaning the code and improve the performance.</p>
<h6 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h6><ol>
<li><p><a target="_blank" rel="noopener" href="https://www.tensorflow.org/lite/performance/post_training_quantization">https://www.tensorflow.org/lite/performance/post_training_quantization</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://margaretmz.medium.com/e2e-tfkeras-tflite-android-273acde6588">https://margaretmz.medium.com/e2e-tfkeras-tflite-android-273acde6588</a></p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/02/03/MQTT-communication-via-Cloud-Broker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/02/03/MQTT-communication-via-Cloud-Broker/" class="post-title-link" itemprop="url">MQTT communication via Cloud Broker</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-03 11:30:58 / Modified: 12:55:43" itemprop="dateCreated datePublished" datetime="2021-02-03T11:30:58+01:00">2021-02-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IoT/" itemprop="url" rel="index"><span itemprop="name">IoT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In my startup, we have worked on some AIoT (AI + IoT) projects and we’ve done some MVPs as demo to our client. In some certain project, we have used MQTT protocol for collecting sensors data and transporting them to other smart devices. So in this post, I would like to present a simple demo for building a MQTT communication via a broker on AWS cloud.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/0j7t523z4u1794795e8n.png" alt="Alt Text"></p>
<blockquote>
<p>MQTT (Message Queuing Telemetry Transport) is an open OASIS and ISO standard (ISO/IEC 20922) lightweight, publish-subscribe network protocol that transports messages between devices. The protocol usually runs over TCP/IP; however, any network protocol that provides ordered, lossless, bi-directional connections can support MQTT. It is designed for connections with remote locations where a “small code footprint” is required or the network bandwidth is limited.</p>
</blockquote>
<h2 id="Cloud-side"><a href="#Cloud-side" class="headerlink" title="Cloud side"></a>Cloud side</h2><p>On AWS server, I use docker to run an <strong>emqx</strong> service which play a role as “broker”. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run --rm -ti --name emqx -p 18083:18083 -p 1883:1883 -e EMQX_ADMIN_PASSWORD=<span class="string">&quot;myPasswd&quot;</span> emqx/emqx:latest</span><br></pre></td></tr></table></figure>
<p>Output of my putty terminal:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/bvggl47m4yijn4ip8jow.png" alt="Alt Text"></p>
<p>When this service is running, one can access to its administration page by visiting <code>http://3.138.200.179:18083/#/</code>:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/oocjtky7e5sgkjcinidc.png" alt="Alt Text"></p>
<h2 id="Subscriber"><a href="#Subscriber" class="headerlink" title="Subscriber"></a>Subscriber</h2><p>I have a subcriber.py file which defines a <code>mqtt</code> client who connects to cloud broker with port 1883 and subscribes message named <code>&#39;qiu_data&#39;</code>. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paho.mqtt.client <span class="keyword">as</span> mqtt</span><br><span class="line"></span><br><span class="line"><span class="comment">## callback upon connection</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_connect</span>(<span class="params">client, userdata, flags, rc</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Connected, result code: &quot;</span> + <span class="built_in">str</span>(rc))</span><br><span class="line"></span><br><span class="line"><span class="comment">## callback upon arrival of msg</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">client, userdata, msg</span>):</span></span><br><span class="line">    print(msg.topic + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(msg.payload))</span><br><span class="line"></span><br><span class="line">client = mqtt.Client()</span><br><span class="line">client.on_connect = on_connect</span><br><span class="line">client.on_message = on_message</span><br><span class="line"><span class="comment"># client.on_disconnect = on_disconnect</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## I have not yet bindded a domain name for my AWS ECS</span></span><br><span class="line">client.connect(<span class="string">&#x27;3.138.200.179&#x27;</span>, <span class="number">1883</span>, <span class="number">600</span>) <span class="comment"># 600ms: keepalive interval setting</span></span><br><span class="line">client.subscribe(<span class="string">&#x27;qiu_data&#x27;</span>, qos=<span class="number">0</span>)</span><br><span class="line">client.loop_forever() <span class="comment"># keep running</span></span><br></pre></td></tr></table></figure>
<h2 id="Publisher"><a href="#Publisher" class="headerlink" title="Publisher"></a>Publisher</h2><p>I have a publisher.py file which defines another <code>mqtt</code> client who connects to cloud broker with port 1883 and publish some data in  <code>&#39;qiu_data&#39;</code> messages. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> paho.mqtt.client <span class="keyword">as</span> mqtt</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_connect</span>(<span class="params">client, userdata, flags, rc</span>):</span></span><br><span class="line">    print(<span class="string">&quot;Connected with result code: &quot;</span> + <span class="built_in">str</span>(rc))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">on_message</span>(<span class="params">client, userdata, msg</span>):</span></span><br><span class="line">    print(msg.topic + <span class="string">&quot; &quot;</span> + <span class="built_in">str</span>(msg.payload))</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&quot;type&quot;</span>: <span class="string">&quot;IoT&quot;</span>,</span><br><span class="line">    <span class="string">&quot;timestamp&quot;</span>: time.time(),</span><br><span class="line">    <span class="string">&quot;msgId&quot;</span>:<span class="string">&quot;8ed7a307-0e82-9738-xxxx&quot;</span>,</span><br><span class="line">    <span class="string">&quot;data&quot;</span>:&#123;</span><br><span class="line">        <span class="string">&quot;temp&quot;</span>:<span class="number">23.5</span>,</span><br><span class="line">        <span class="string">&quot;speed&quot;</span>:<span class="number">46.8</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">param = json.dumps(data)</span><br><span class="line"></span><br><span class="line">client = mqtt.Client()</span><br><span class="line">client.on_connect = on_connect</span><br><span class="line">client.on_message = on_message</span><br><span class="line">client.connect(<span class="string">&#x27;3.138.200.179&#x27;</span>, <span class="number">1883</span>, <span class="number">600</span>) <span class="comment"># 600ms for keepalive</span></span><br><span class="line">client.publish(<span class="string">&#x27;qiu_data&#x27;</span>, payload=<span class="string">&#x27;hello world&#x27;</span>, qos=<span class="number">0</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">client.publish(<span class="string">&quot;qiu_data&quot;</span>, payload=param, qos=<span class="number">0</span>) </span><br></pre></td></tr></table></figure>
<h2 id="Execution"><a href="#Execution" class="headerlink" title="Execution"></a>Execution</h2><p>In a terminal I type <code>python subcriber.py</code>, and in a second terminal I type <code>python publisher.py</code>. See the published topics have been received in the subscriber’s terminal:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/1hhk9ll9kb4n3eokhva9.PNG" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/18/Breathing-Detection-Using-Computer-vision-with-webcam/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/18/Breathing-Detection-Using-Computer-vision-with-webcam/" class="post-title-link" itemprop="url">Breathing Detection Using Computer vision with webcam</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-18 14:07:48 / Modified: 15:29:59" itemprop="dateCreated datePublished" datetime="2021-01-18T14:07:48+01:00">2021-01-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>When I worked on the development of a healthcare device for detecting baby Apnea (pause of breathing), I have spent some time on studying possible technological solutions. I have tried several different types of sensors including: RGB-camera, 3-axis accelerometer, heat camera, depth camera (kinect), etc. The rgb-camera-based solution is very interesting. Firstly because they are low-cost; moreover, it does not require mounting the sensor on baby’s body thus the comfort is guaranteed. That’s why I worked for about 3 weeks on this solution.</p>
<p>As experiments, I tried multiple possible algorithms including: feature points tracking, inter-frame difference checking, flux, and  color nuance variation tracking. </p>
<p>In this post, I want to present the latter one. This work is inspired by <a target="_blank" rel="noopener" href="http://people.csail.mit.edu/mrub/vidmag/">this study</a>. The basic idea is to track the color variation of an ROI on human face. The blood circulation and breathing will cause slight color variation of our skin. This change is so slight that our eyes can not perceive it at all. However, a normal webcam can identify color variation with a resolution as high as 2^16 grades. </p>
<h2 id="ROI-on-human-forehead"><a href="#ROI-on-human-forehead" class="headerlink" title="ROI on human forehead"></a>ROI on human forehead</h2><p>I have chosen a small rectangle area as ROI (region of interest) for tracking color variation. Below is the part of code for this purpose.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">x1 = <span class="number">0.4</span></span><br><span class="line">x2 = <span class="number">0.6</span></span><br><span class="line">y1 = <span class="number">0.1</span></span><br><span class="line">y2 = <span class="number">0.25</span></span><br><span class="line">face_cascade=cv2.CascadeClassifier(cv2.data.haarcascades + <span class="string">&quot;haarcascade_frontalface_default.xml&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getFaceROI</span>(<span class="params">img</span>):</span></span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_RGB2GRAY)</span><br><span class="line">    faces = face_cascade.detectMultiScale(gray, <span class="number">1.2</span>, <span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(faces)&gt;<span class="number">0</span>:</span><br><span class="line">        img=cv2.rectangle(img, (faces[<span class="number">0</span>][<span class="number">0</span>] + <span class="built_in">int</span>(x1*faces[<span class="number">0</span>][<span class="number">2</span>]), faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y1*faces[<span class="number">0</span>][<span class="number">3</span>]) ), (faces[<span class="number">0</span>][<span class="number">0</span>]+ <span class="built_in">int</span>(x2*faces[<span class="number">0</span>][<span class="number">2</span>]), faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y2*faces[<span class="number">0</span>][<span class="number">3</span>]) ), (<span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> [faces[<span class="number">0</span>][<span class="number">0</span>]+<span class="built_in">int</span>(x1*faces[<span class="number">0</span>][<span class="number">2</span>]),  faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y1*faces[<span class="number">0</span>][<span class="number">3</span>]),  faces[<span class="number">0</span>][<span class="number">0</span>]+ <span class="built_in">int</span>(x2*faces[<span class="number">0</span>][<span class="number">2</span>]), faces[<span class="number">0</span>][<span class="number">1</span>]+ <span class="built_in">int</span>(y2*faces[<span class="number">0</span>][<span class="number">3</span>])]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> [<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<h2 id="Color-Calculation"><a href="#Color-Calculation" class="headerlink" title="Color Calculation"></a>Color Calculation</h2><p>We simply calculate the average value of a given color channel (I used the green channel in my test) of all the pixels in the selected ROI.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getColorAverage</span>(<span class="params">frame, color_id</span>):</span></span><br><span class="line">    <span class="keyword">return</span> frame[:,:,color_id].<span class="built_in">sum</span>()*<span class="number">1.0</span> / (frame.shape[<span class="number">0</span>]*frame.shape[<span class="number">1</span>])</span><br></pre></td></tr></table></figure>

<h2 id="Drawbacks"><a href="#Drawbacks" class="headerlink" title="Drawbacks"></a>Drawbacks</h2><p>Entire code has been uploaded to github repo below:<br><a target="_blank" rel="noopener" href="https://github.com/QiuZhaopeng/CV2_heartbeat_breathing_detection">https://github.com/QiuZhaopeng/CV2_heartbeat_breathing_detection</a></p>
<p>This solution suffers from limitations in multiple aspects, e.g. the lighting condition, human should stay still, the camera noisy level, etc. That’s why I did not choose this solution for our product (finally we chose the 6-axis sensor solution). </p>
<h2 id="Result"><a href="#Result" class="headerlink" title="Result"></a>Result</h2><p>Below is the snapshot of the execution of this program. As one can see, there are low-frequency wave shape mixed with high-frequency sawtooth (small peaks).<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/jfa4iwr1jimxi67bjiro.png" alt="Alt Text"><br>I measured my pulses during execution of this program. It can be verified that each small peak corresponds to a pulse beat (heart beat). And the large peak-valley transition corresponds to breathing cycles. </p>
<p>Anyone interested in this small experiment are encouraged to try it and do some further work. Good luck.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/14/MongoDB-Compass-connection-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/14/MongoDB-Compass-connection-issue/" class="post-title-link" itemprop="url">MongoDB Compass connection issue</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-14 12:27:03 / Modified: 12:33:28" itemprop="dateCreated datePublished" datetime="2021-01-14T12:27:03+01:00">2021-01-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IT/" itemprop="url" rel="index"><span itemprop="name">IT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>I am working on migration of our <em>Data Warehouse</em> project from <em>Alibaba Cloud</em> to <em>Huawei Cloud</em> this week. All goes well, except one issue occurs when I tried to connect to <strong>MongoDB</strong> using <strong>MongoDB Compass Community</strong>. </p>
<p>As I have presented in my <a target="_blank" rel="noopener" href="https://dev.to/jemaloqiu/install-mongodb-with-docker-in-ubuntu-18-04-4pbi">previous post</a>, I have deployed <strong>MongoDB</strong> service using <strong>docker</strong> and I have successfully connected to my <strong>MongoDB</strong> database from <strong>IPython</strong> console. So I firstly tried again the visit from <strong>IPython</strong> today to make sure that the <strong>MongoDB</strong> service is still running on Huawei ECS. It IS still working well:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/inkrwaealqvcv183n10a.png" alt="Alt Text"></p>
<p>Then I open <strong>MongoDB Compass Community</strong> and fill the login information as below (our domain name has not yet been authorized so I have to use Ip address for <em>hostname</em>):<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/e2uyrzwtepgxxkaao9q8.png" alt="Alt Text"><br>However, when I click “CONNECT” button, nothing happens.</p>
<p>After a close investigation, I found the reason. After I filled all the fields for connection, <strong>Compass</strong> yielded a connection URI string as below.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/iwfcg0mb6hebayyq9lhe.png" alt="Alt Text"></p>
<p>In fact, as explained in official manual of <strong>MongoDB</strong>, the standard URI syntax for connection is as:<br><code>mongodb://[username:password@]host1[:port1][,host2[:port2],...[,hostN[:portN]]][/[database][?options]]</code>.<br>Thus in my case, <strong>MongoDB Compass</strong> has strangely used <code>ip:port</code> as the Database name to visit. Since there is no database with such name, so it shall do nothing and stays in the connection interface.</p>
<p>Now I correct the URI string manually and fill my database name <em>suppliers</em> into this string as below:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/1wez341jzvar701lbflr.png" alt="Alt Text"></p>
<p>Once I click “CONNECT”, <strong>Compass</strong> jumps as expected to display interface of the queried database now:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/6s8udjmskichqb0ay5id.png" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/12/Native-Mobile-Application-dev-using-HTML5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/Native-Mobile-Application-dev-using-HTML5/" class="post-title-link" itemprop="url">Native Mobile Application dev using HTML5</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2021-01-12 18:54:35" itemprop="dateCreated datePublished" datetime="2021-01-12T18:54:35+01:00">2021-01-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2021-01-13 10:14:58" itemprop="dateModified" datetime="2021-01-13T10:14:58+01:00">2021-01-13</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IT/" itemprop="url" rel="index"><span itemprop="name">IT</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>I started learning <strong>JavaScript</strong> since November 2018. Since then, I fell in love with this powerful language. In this post, I would like to share my experience of app dev using <strong>JavaScript</strong>  and to encourage you guys to develop apps using <strong>HTML5</strong> tech.</p>
<p>My first experience with <strong>JS</strong> started with <a target="_blank" rel="noopener" href="https://www.dcloud.io/mui.html"><code>MUI</code></a> by using which I aimed to develop an mobile application to measure human abdomen movements using smartphone’s accelerator sensor. <code>MUI</code> is a H5-based framework for developing “native” applications (can be called Chinese-version <code>Reaction Native</code>?). The <code>MUI</code> team has also developed <code>HTML5plus</code> sdk (Chinese-version <code>Cordova</code>) which grants applications the access to host device’s capabilities such as sensors, phone status, etc. With these tools, I have easily developed my application within two days. One month later, we have decided to develop an application for communicating with our smart wearable hardware via Bluetooth. Thus along with progress of hardware development, I have developed another application for testing communications with the hardware and for collecting test data. Several months later, this application becomes a very useful tool for our team, which is used to: flash the firmware, testing the stability of BLE connection, adjusting parameters for algorithm and embedded software, collecting debug logs, data collecting during nightly tests, ROB (robustness) issues investigation, etc.</p>
<p>For copyright reason, I cannot share the source code of this application. Below are screenshots of two non-secret parts of my code. The bluetooth dev manual is given <a target="_blank" rel="noopener" href="http://www.html5plus.org/doc/zh_cn/bluetooth.html">here</a>.</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/rlz6vtuje0xeivoeiykx.PNG" alt="Alt Text"><br><img src="https://dev-to-uploads.s3.amazonaws.com/i/b3kgwudn816tvqoqo0co.PNG" alt="Alt Text"></p>
<p>This is a video showing how I did the test with my application and the wearable hardware prototype.</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/o4wFFWRzx88" frameborder="0" loading="lazy" allowfullscreen></iframe></div> 



<p>Another video of motion data collection on a premature baby using my app:</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/NwDZiueJlrw" frameborder="0" loading="lazy" allowfullscreen></iframe></div> 
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/12/Reinforcement-Learning-with-TF2-and-Gym-Actor-Critic/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/12/Reinforcement-Learning-with-TF2-and-Gym-Actor-Critic/" class="post-title-link" itemprop="url">Reinforcement Learning with TF2 and Gym: Actor-Critic</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-12 10:29:44 / Modified: 10:35:39" itemprop="dateCreated datePublished" datetime="2021-01-12T10:29:44+01:00">2021-01-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Recently I started to do exercise with a new RL method: <strong>Actor-Critic</strong>. The basic idea is quite similar to <strong>GAN network</strong>. Unlike <strong>Policy Gradient</strong> in which a single neural network is trained, <strong>Actor-Critic</strong> uses two neural networks: an “actor” for performing actions and a “critic” for evaluating action of the actor. I refer to <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=xjd7Jq9wPQY">this page</a> for details of this method. </p>
<h3 id="Model-presentation"><a href="#Model-presentation" class="headerlink" title="Model presentation"></a>Model presentation</h3><p>Given a state <code>s_t</code> at time <em>t</em>, the network calculates the action probabilities and chooses an action <code>a_t</code> to apply on env:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/qyn1s4ckmrhdb5p2tsoq.PNG" alt="Alt Text"></p>
<p>After the application of action <code>a_t</code>, then env updated accordingly, yields reward <code>r_t</code>, we observe at next time step t+1 a new state <code>s_t+1</code> which results in a new sampled action <code>a_t+1</code>:<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/xgrowra6h096oaoeho52.PNG" alt="Alt Text"></p>
<h3 id="Steps-of-the-basic-Actor-Critic-method"><a href="#Steps-of-the-basic-Actor-Critic-method" class="headerlink" title="Steps of the basic Actor-Critic method"></a>Steps of the basic Actor-Critic method</h3><p>Unlike the <strong>Policy Gradient</strong> which needs to gather all data of an episode to calculate gradients, Actor-Critic method performs model update in every agent-env interaction loop :</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/7a2lsxp4osi3vur2kop3.PNG" alt="Alt Text"></p>
<h3 id="Implementation-with-CartPole-game"><a href="#Implementation-with-CartPole-game" class="headerlink" title="Implementation with CartPole game"></a>Implementation with CartPole game</h3><p>I followed <a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2vJtbAha3To">this youtube video</a> for my first Actor-Critic exercise. It was initially based on pure <strong>Keras</strong> thus I have modified some of his code for using <strong>tensorflow</strong>. I also disabled eager mode because of a runtime error (I am using Tensorflow v2 on my laptop).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line">tf.compat.v1.disable_eager_execution()</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Activation, Dense, Input</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> Adam</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, alpha, beta, gamma=<span class="number">0.99</span>, n_actions=<span class="number">2</span>, \</span></span></span><br><span class="line"><span class="function"><span class="params">                layer1_size=<span class="number">1024</span>, layer2_size=<span class="number">512</span>, input_dims=<span class="number">4</span></span>):</span></span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.alpha = alpha</span><br><span class="line">        self.beta = beta</span><br><span class="line">        self.input_dims = input_dims</span><br><span class="line">        self.fc1_dims = layer1_size</span><br><span class="line">        self.fc2_dims = layer2_size</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        </span><br><span class="line">        self.actor, self.critic, self.policy = self.build_network()</span><br><span class="line">        </span><br><span class="line">        self.action_space = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n_actions)]</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_network</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">input</span> = Input(shape=(self.input_dims, ))</span><br><span class="line">        delta = Input(shape=[<span class="number">1</span>])</span><br><span class="line">        dense1 = Dense(self.fc1_dims, activation=<span class="string">&quot;relu&quot;</span>)(<span class="built_in">input</span>)</span><br><span class="line">        dense2 = Dense(self.fc2_dims, activation=<span class="string">&quot;relu&quot;</span>)(dense1)</span><br><span class="line">        probs = Dense(self.n_actions, activation=<span class="string">&quot;softmax&quot;</span>)(dense2)</span><br><span class="line">        values = Dense(<span class="number">1</span>, activation=<span class="string">&quot;linear&quot;</span>)(dense2)</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">custom_loss</span>(<span class="params">y_true, y_pred</span>):</span></span><br><span class="line">            out = K.clip(y_pred, <span class="number">1e-8</span>, <span class="number">1</span>-<span class="number">1e-8</span>)  </span><br><span class="line">            log_lik = y_true * K.log(out)            </span><br><span class="line">            <span class="keyword">return</span> K.<span class="built_in">sum</span>(-log_lik*delta)</span><br><span class="line">            </span><br><span class="line">        actor = Model(inputs=[<span class="built_in">input</span>, delta], outputs=[probs])</span><br><span class="line">        actor.<span class="built_in">compile</span>(optimizer=Adam(lr=self.alpha), loss=custom_loss)</span><br><span class="line">        </span><br><span class="line">        critic = Model(inputs=[<span class="built_in">input</span>], outputs=[values])</span><br><span class="line">        critic.<span class="built_in">compile</span>(optimizer=Adam(lr=self.beta), loss=<span class="string">&quot;mse&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        policy = Model(inputs=[<span class="built_in">input</span>], outputs=[probs])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> actor, critic, policy</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">choose_action</span>(<span class="params">self, observation</span>):</span></span><br><span class="line">    </span><br><span class="line">        state = observation[np.newaxis, :]</span><br><span class="line">        probs = self.policy.predict(state)[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        action = np.random.choice(self.action_space, p=probs)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">learn</span>(<span class="params">self, state, action, reward, state_, done</span>):</span></span><br><span class="line">        state = state[np.newaxis, :]</span><br><span class="line">        state_ = state_[np.newaxis, :]</span><br><span class="line">        critic_value_ = self.critic.predict(state_)</span><br><span class="line">        critic_value = self.critic.predict(state)</span><br><span class="line">        </span><br><span class="line">        target = reward + self.gamma*critic_value_*(<span class="number">1</span>-<span class="built_in">int</span>(done))</span><br><span class="line">        delta = target - critic_value</span><br><span class="line">        </span><br><span class="line">        actions = np.zeros([<span class="number">1</span>, self.n_actions])</span><br><span class="line">        actions[np.arange(<span class="number">1</span>), action] = <span class="number">1.0</span></span><br><span class="line">        </span><br><span class="line">        self.actor.fit([state, delta], actions, verbose=<span class="number">0</span>)</span><br><span class="line">        self.critic.fit(state, target, verbose=<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    agent=Agent(alpha=<span class="number">0.0001</span>, beta=<span class="number">0.0005</span>)</span><br><span class="line">    env = gym.make(<span class="string">&quot;CartPole-v0&quot;</span>)</span><br><span class="line">    score_history = []</span><br><span class="line">    num_episodes = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">        done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        observation = env.reset()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">            env.render()</span><br><span class="line">            action = agent.choose_action(observation)</span><br><span class="line">            observation_, reward, done, info= env.step(action)</span><br><span class="line">            agent.learn(observation, action, reward, observation_, done)</span><br><span class="line">            observation = observation_</span><br><span class="line">            score+=reward</span><br><span class="line">            </span><br><span class="line">        score_history.append(score)</span><br><span class="line">        avg_score = np.mean(score_history[-<span class="number">100</span>:])</span><br><span class="line">        print(<span class="string">&quot;episode &quot;</span>, i, <span class="string">&quot;score %.2f average score %.2f&quot;</span> % (score, avg_score))</span><br></pre></td></tr></table></figure>

<h3 id="A-newer-version"><a href="#A-newer-version" class="headerlink" title="A newer version"></a>A newer version</h3><p>I have updated the program shown above to allow eager mode. The main difference is the introduction of the custom loss function for actor. It works well, however, the running speed is much slower after my modification (I am looking forward to Refactoring it later).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.environ[<span class="string">&#x27;TF_CPP_MIN_LOG_LEVEL&#x27;</span>] = <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> tf.__version__.startswith(<span class="string">&quot;1.&quot;</span>):    </span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">&quot;Error!! You are using tensorflow-v1&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">from</span> tensorflow.keras <span class="keyword">import</span> backend <span class="keyword">as</span> K</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.layers <span class="keyword">import</span> Activation, Dense, Input</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.models <span class="keyword">import</span> Model</span><br><span class="line"><span class="keyword">from</span> tensorflow.keras.optimizers <span class="keyword">import</span> Adam</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> gym</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Agent</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, alpha, beta, gamma=<span class="number">0.99</span>, n_actions=<span class="number">2</span>, \</span></span></span><br><span class="line"><span class="function"><span class="params">                layer1_size=<span class="number">1024</span>, layer2_size=<span class="number">512</span>, input_dims=<span class="number">4</span></span>):</span></span><br><span class="line">        self.gamma = gamma</span><br><span class="line">        self.alpha = alpha</span><br><span class="line">        self.beta = beta</span><br><span class="line">        self.input_dims = input_dims</span><br><span class="line">        self.fc1_dims = layer1_size</span><br><span class="line">        self.fc2_dims = layer2_size</span><br><span class="line">        self.n_actions = n_actions</span><br><span class="line">        </span><br><span class="line">        self.actor, self.critic, self.policy = self.build_network()</span><br><span class="line">        </span><br><span class="line">        self.action_space = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(self.n_actions)]</span><br><span class="line"></span><br><span class="line">        self.optimizer = tf.keras.optimizers.Adam(learning_rate=self.alpha)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_network</span>(<span class="params">self</span>):</span></span><br><span class="line">    </span><br><span class="line">        <span class="built_in">input</span> = Input(shape=(self.input_dims, ))</span><br><span class="line">        delta = Input(shape=[<span class="number">1</span>])</span><br><span class="line">        dense1 = Dense(self.fc1_dims, activation=<span class="string">&quot;relu&quot;</span>)(<span class="built_in">input</span>)</span><br><span class="line">        dense2 = Dense(self.fc2_dims, activation=<span class="string">&quot;relu&quot;</span>)(dense1)</span><br><span class="line">        probs = Dense(self.n_actions, activation=<span class="string">&quot;softmax&quot;</span>)(dense2)</span><br><span class="line">        values = Dense(<span class="number">1</span>, activation=<span class="string">&quot;linear&quot;</span>)(dense2)</span><br><span class="line"></span><br><span class="line">        actor = Model(inputs=[<span class="built_in">input</span>, delta], outputs=[probs])</span><br><span class="line">        </span><br><span class="line">        critic = Model(inputs=[<span class="built_in">input</span>], outputs=[values])</span><br><span class="line">        critic.<span class="built_in">compile</span>(optimizer=Adam(lr=self.beta), loss=<span class="string">&quot;mse&quot;</span>)</span><br><span class="line">        </span><br><span class="line">        policy = Model(inputs=[<span class="built_in">input</span>], outputs=[probs])</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> actor, critic, policy</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">choose_action</span>(<span class="params">self, observation</span>):</span></span><br><span class="line">    </span><br><span class="line">        state = observation[np.newaxis, :]</span><br><span class="line">        probs = self.policy.predict(state)[<span class="number">0</span>]</span><br><span class="line">        </span><br><span class="line">        action = np.random.choice(self.action_space, p=probs)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> action</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">learn</span>(<span class="params">self, state, action, reward, state_, done</span>):</span></span><br><span class="line">        state = state[np.newaxis, :]</span><br><span class="line">        state_ = state_[np.newaxis, :]</span><br><span class="line">        critic_value_ = self.critic.predict(state_)</span><br><span class="line">        critic_value = self.critic.predict(state)</span><br><span class="line">        </span><br><span class="line">        target = reward + self.gamma*critic_value_*(<span class="number">1</span>-<span class="built_in">int</span>(done))</span><br><span class="line">        delta = target - critic_value</span><br><span class="line">        </span><br><span class="line">        actions = np.zeros([<span class="number">1</span>, self.n_actions])</span><br><span class="line">        actions[np.arange(<span class="number">1</span>), action] = <span class="number">1.0</span></span><br><span class="line">        </span><br><span class="line">        self.critic.fit(state, target, verbose=<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> tf.GradientTape() <span class="keyword">as</span> tape:</span><br><span class="line">            y_pred = self.actor(state)</span><br><span class="line">            out = K.clip(y_pred, <span class="number">1e-8</span>, <span class="number">1</span>-<span class="number">1e-8</span>)  </span><br><span class="line">            log_lik = actions * K.log(out)            </span><br><span class="line">            myloss = K.<span class="built_in">sum</span>(-log_lik*delta)</span><br><span class="line">        grads = tape.gradient(myloss, self.actor.trainable_variables)</span><br><span class="line"></span><br><span class="line">        self.optimizer.apply_gradients(<span class="built_in">zip</span>(grads, self.actor.trainable_variables))</span><br><span class="line">            </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    agent=Agent(alpha=<span class="number">0.0001</span>, beta=<span class="number">0.0005</span>)</span><br><span class="line"></span><br><span class="line">    ENV_SEED = <span class="number">1024</span>  <span class="comment">## Reproducibility of the game</span></span><br><span class="line">    NP_SEED = <span class="number">1024</span>  <span class="comment">## Reproducibility of numpy random</span></span><br><span class="line">    env = gym.make(<span class="string">&#x27;CartPole-v0&#x27;</span>)</span><br><span class="line">    env = env.unwrapped    <span class="comment"># use unwrapped version, otherwise episodes will terminate after 200 steps</span></span><br><span class="line">    env.seed(ENV_SEED)  </span><br><span class="line">    np.random.seed(NP_SEED)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">### The Discrete space allows a fixed range of non-negative numbers, so in this case valid actions are either 0 or 1. </span></span><br><span class="line">    print(env.action_space)</span><br><span class="line">    <span class="comment">### The Box space represents an n-dimensional box, so valid observations will be an array of 4 numbers. </span></span><br><span class="line">    print(env.observation_space)</span><br><span class="line">    <span class="comment">### We can also check the Box’s bounds:</span></span><br><span class="line">    print(env.observation_space.high)</span><br><span class="line">    print(env.observation_space.low)</span><br><span class="line"></span><br><span class="line">    score_history = []</span><br><span class="line">    num_episodes = <span class="number">2000</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num_episodes):</span><br><span class="line">        done = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        score = <span class="number">0</span></span><br><span class="line">        observation = env.reset()</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> done:</span><br><span class="line">            env.render()</span><br><span class="line">            action = agent.choose_action(observation)</span><br><span class="line">            observation_, reward, done, info= env.step(action)</span><br><span class="line">            agent.learn(observation, action, reward, observation_, done)</span><br><span class="line">            observation = observation_</span><br><span class="line">            score+=reward</span><br><span class="line">            </span><br><span class="line">        score_history.append(score)</span><br><span class="line">        avg_score = np.mean(score_history[-<span class="number">100</span>:])</span><br><span class="line">        print(<span class="string">&quot;episode &quot;</span>, i, <span class="string">&quot;score %.2f average score %.2f&quot;</span> % (score, avg_score))</span><br></pre></td></tr></table></figure>
<p>The training converges ideally. Below is a snapshot of the execution output:</p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/h7kwg09gwsep9a6np10v.PNG" alt="Alt Text"></p>
<h5 id="References"><a href="#References" class="headerlink" title="References:"></a>References:</h5><p>*<a target="_blank" rel="noopener" href="https://github.com/wangshusen/DRL">https://github.com/wangshusen/DRL</a><br>*<a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=2vJtbAha3To">https://www.youtube.com/watch?v=2vJtbAha3To</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://qiuzhaopeng.github.io/2021/01/11/A-A-Star-algorithm-for-solving-Sliding-Tiles-Game/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/qiu.png">
      <meta itemprop="name" content="Zhaopeng QIU">
      <meta itemprop="description" content="Stay hungry, stay foolish">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Zhaopeng's Homepage">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/11/A-A-Star-algorithm-for-solving-Sliding-Tiles-Game/" class="post-title-link" itemprop="url">A* (A-Star) algorithm for solving Sliding Tiles Game</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-01-11 12:58:45 / Modified: 13:00:20" itemprop="dateCreated datePublished" datetime="2021-01-11T12:58:45+01:00">2021-01-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This weekend I found in my old hard disk a tiny game I wrote years ago. I was learning motion planning algorithms in that period, thus this game was one exercise of mine for testing the <strong>A* search algorithm</strong> (see <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/A*_search_algorithm">introduction</a>). This algorithm is a very traditional one thus I will not present it in my post. One who is interested can read [this book] (<a target="_blank" rel="noopener" href="http://lavalle.pl/planning/">http://lavalle.pl/planning/</a>) By Steven M. LaValle for details. </p>
<h2 id="Number-tiles-Game-in-Visual-Studio"><a href="#Number-tiles-Game-in-Visual-Studio" class="headerlink" title="Number tiles Game in Visual Studio"></a>Number tiles Game in Visual Studio</h2><p>I developed the sliding number tiles game (shown below) as a small desktop software using Visual Studio.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/l9iasejgl73xuj6bxkt7.PNG" alt="Alt Text"></p>
<p>This video shows how I solve the game manually (I am not quite good at it):</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/kU1aec4fqfc" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<h2 id="Solving-it-using-A"><a href="#Solving-it-using-A" class="headerlink" title="Solving it using A*"></a>Solving it using A*</h2><p>Now I touch “S”-key of my keyboard, and the A* algorithm starts to solve the puzzle (search a path). And I push “S”-key again, it starts to show the solution.</p>
<div class="video-container"><iframe src="https://www.youtube.com/embed/tsv5wD8s2Ks" frameborder="0" loading="lazy" allowfullscreen></iframe></div>

<p>The code has been pushed to <a target="_blank" rel="noopener" href="https://github.com/jemaloQ/astar_search_game.git">this repo</a>. </p>
<p>Below are simple explanations of the algorithm in this example.</p>
<h2 id="Algorithm-explanation"><a href="#Algorithm-explanation" class="headerlink" title="Algorithm explanation"></a>Algorithm explanation</h2><h3 id="Node-and-graph"><a href="#Node-and-graph" class="headerlink" title="Node and graph"></a>Node and graph</h3><p>Each configuration of this game corresponds to a node in its state graph as shown below. So in order to solve this game, we need to find a path that links node start to node target via a sequence of intermediate nodes.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/z65q1qk594ahgpippp6a.PNG" alt="Alt Text"></p>
<h3 id="Assumptions"><a href="#Assumptions" class="headerlink" title="Assumptions"></a>Assumptions</h3><p>We assure that the <strong>assumptions</strong> are satisfied in this example: </p>
<ol>
<li>there are limited number of states; </li>
<li>there is a valid heuristic function for assessing the distance between nodes: sum of distance (in number of moves) for each tile from its current position to its target position</li>
</ol>
<h3 id="Some-conceptions"><a href="#Some-conceptions" class="headerlink" title="Some conceptions:"></a>Some conceptions:</h3><p><strong>Closed set</strong>: a set of nodes that has been assessed<br><strong>Frontier set</strong>: a set of nodes that are about to be explored</p>
<h3 id="StateNode-class"><a href="#StateNode-class" class="headerlink" title="StateNode class"></a>StateNode class</h3><p>Each state node object in the code has value members:<br><strong>parent</strong>: a node from which current node comes with one move<br><strong>g</strong>: path cost from <strong>start</strong> node to current node<br><strong>h</strong>: distance cost from current node to <strong>target</strong> node<br><strong>isExpanded</strong>: a flag noting if all neighbors of this node are in <strong>Closed set</strong></p>
<h3 id="Algorithm-pseudo-code-details"><a href="#Algorithm-pseudo-code-details" class="headerlink" title="Algorithm pseudo-code details:"></a>Algorithm pseudo-code details:</h3><p><strong>Init</strong>: put start node into closed set and frontier set</p>
<p><strong>Explore_node</strong> for a given node:</p>
<p>I have developed the core function of this algorithm <em>explore_Tree</em>(<strong>n_i</strong>) and it do the following works in a recursive way:<br>    (1) for each neighbor nodes <strong>n_k</strong> of node <strong>n_i</strong>, check firstly if <strong>n_k</strong> is already included in closed set.<br>    (2) If we get YES for step 1, and if current cost of <strong>n_k</strong> (namely: <strong>g+h</strong>) is lower than its cost in the <strong>closed set</strong>, update its cost and update its parent as <strong>n_i</strong>;<br>    (3) If we get NO for step 1: put current node <strong>n_k</strong> into <strong>frontier</strong> and <strong>closed set</strong>, calculate its cost, define <strong>n_k</strong>‘s parent as <strong>n_i</strong><br>    (4) delete <strong>n_i</strong> from <strong>frontier set</strong><br>    (5) check if any node in <strong>frontier</strong> has reached target node<br>    (6) if target reached, return True<br>    (7) if target not yet reached, select <strong>node of the lowest cost from frontier set</strong>, and call function <em>explore_Tree()</em> for it.</p>
<p>If <strong>Explore_node</strong> finally returns True, it means that the optimal path is found. We can then retrieve the path by tracking recursively the parent, starting from the target node.</p>
<h3 id="Illustration"><a href="#Illustration" class="headerlink" title="Illustration"></a>Illustration</h3><p>The following image shows the first step of this algorithm: exploring neighbors of the start node and assessing the cost of each node.<br><img src="https://dev-to-uploads.s3.amazonaws.com/i/mo16qo6j52ir6n6d0gpn.PNG" alt="Alt Text"></p>
<p>Following the step shown above, the image below shows the how A* explores recursively the “optimal” move. In this step, it locates the lowest-cost node in frontier then explores its neighbors and assesses their cost. </p>
<p><img src="https://dev-to-uploads.s3.amazonaws.com/i/2fj62u79o04fh8g64pxh.PNG" alt="Alt Text"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Zhaopeng QIU"
      src="/images/qiu.png">
  <p class="site-author-name" itemprop="name">Zhaopeng QIU</p>
  <div class="site-description" itemprop="description">Stay hungry, stay foolish</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Zhaopeng QIU</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>
